--- src/log.c	2012-06-03 15:43:45.000000000 -0700
+++ /Users/wstein/log.c	2012-07-18 18:05:15.000000000 -0700
@@ -663,6 +663,16 @@
 	int nblogger;
 	char *log_ptr;
 
+	FILE *file; 
+	static char* logfile=0;
+	if (!logfile) {
+		logfile = getenv("HAPROXY_LOGFILE");
+		if (logfile)
+			printf("Logging to file %s because HAPROXY_LOGFILE is set\n", logfile);
+		else
+			printf("HAPROXY_LOGFILE is not set\n");
+	}
+
 	dataptr = message;
 
 	if (p == NULL) {
@@ -739,12 +749,18 @@
 		} while (fac_level && log_ptr > dataptr);
 		*log_ptr = '<';
 
-		sent = sendto(*plogfd, log_ptr, size + log_ptr - dataptr,
+		if (logfile) {
+			file = fopen(logfile,"a");
+			fprintf(file, "%s", log_ptr); 
+			fclose(file);
+		} else {
+			sent = sendto(*plogfd, log_ptr, size + log_ptr - dataptr,
 			      MSG_DONTWAIT | MSG_NOSIGNAL,
 			      (struct sockaddr *)&logsrv->addr, get_addr_len(&logsrv->addr));
-		if (sent < 0) {
-			Alert("sendto logger #%d failed: %s (errno=%d)\n",
-				nblogger, strerror(errno), errno);
+			if (sent < 0) {
+				Alert("sendto logger #%d failed: %s (errno=%d)\n",
+				      nblogger, strerror(errno), errno);
+			}
 		}
 		nblogger++;
 	}
