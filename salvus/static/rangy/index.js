// Generated by CoffeeScript 1.4.0

/*
# coffee -w -c index.coffee
*/


(function() {

  $(function() {
    var execute_code, page;
    $.fn.extend({
      salvus_worksheet: function(opts) {
        return this.each(function() {
          var worksheet;
          worksheet = $(".salvus-templates").find(".salvus-worksheet").clone();
          $(this).append(worksheet);
          worksheet.append_salvus_cell();
          return worksheet;
        });
      },
      append_salvus_cell: function(opts) {
        return this.each(function() {
          var cell;
          cell = $(".salvus-templates").find(".salvus-cell").clone().data("worksheet", $(this));
          cell.find(".salvus-cell-input").data("cell", cell).keydown(execute_code);
          cell.draggable({
            handle: ".span1"
          });
          $(this).append(cell);
          return cell;
        });
      }
    });
    execute_code = function(e) {
      var cell, input_text, next, output, t;
      if (e.which === 13 && e.shiftKey) {
        t = $(this);
        cell = t.data("cell");
        input_text = t.text();
        output = cell.find(".salvus-cell-output");
        console.log(input_text);
        output.text(eval(input_text));
        next = cell.next();
        if (next.length === 0) {
          next = cell.data("worksheet").append_salvus_cell();
        }
        console.log(next.find(".salvus-cell-input"));
        next.find(".salvus-cell-input").focus();
        return false;
      }
    };
    page = $("#page");
    return page.salvus_worksheet();
  });

}).call(this);
