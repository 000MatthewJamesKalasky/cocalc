// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    var backend, execute_code;
    execute_code = function() {
      $("#output").val("");
      $("#time").html("");
      $("#run_status").html("running...");
      return backend.execute($("#input").val(), function(mesg) {
        var o;
        o = $("#output");
        o.val(o.val() + mesg.output.stdout);
        if (mesg.output.stderr) {
          o.val(o.val() + "\n!!!!!!!!!!!!!!\n" + mesg.output.stderr + "\n!!!!!!!!!!!!!\n");
        }
        return $("#run_status").html((mesg.output.done ? "" : "running..."));
      });
    };
    $("#execute").click(function(e) {
      return execute_code();
    });
    $("body").keydown(function(e) {
      if (e.which === 13 && e.shiftKey) {
        execute_code();
        return false;
      }
    });
    $("#execute").button();
    $("#google").button().click(function() {
      return window.location = "/tornado/auth/google";
    });
    $("#facebook").button().click(function() {
      return window.location = "/tornado/auth/facebook";
    });
    $("#sign_out").button().click(function() {
      $("#username").hide();
      $("#sign_out").hide();
      return $("#sign_in").show();
    });
    backend = salvus.Backend({
      on_login: function(name) {
        $("#username").show().html(name);
        $("#sign_in").hide();
        return $("#sign_out").show();
      },
      onopen: function(protocol) {
        return $("#connection_status").html("connected (" + protocol + ")");
      },
      onclose: function() {
        return $("#connection_status").html("reconnecting...");
      }
    });
    $("#connection_status").html("connecting...");
    $("#sign_in").show();
    $("#sign_out").hide();
    return $("#username").hide();
  });

}).call(this);
