// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    var execute_code, salvus, sign_in, sign_out;
    sign_out = function() {
      return $.getJSON("/tornado/auth/logout", function() {
        $("#username").hide();
        $("#sign_out").hide();
        return $("#sign_in").show();
      });
    };
    sign_in = function(username) {
      $("#sign_in").hide();
      $("#username").show().html(username);
      return $("#sign_out").show();
    };
    $("#sign_in").button().click(function() {
      return window.location = "/tornado/auth/google";
    });
    $("#sign_out").button().hide().click(sign_out);
    execute_code = function() {
      $("#output").val("");
      $("#time").html("");
      $("#run_status").html("running...");
      return salvus.execute($("#input").val(), function(mesg) {
        var o;
        o = $("#output");
        o.val(o.val() + mesg.output.stdout);
        if (mesg.output.stderr) {
          o.val(o.val() + ("\n!!!!!!!!!!!!!!\n" + mesg.output.stderr + "\n!!!!!!!!!!!!!\n"));
        }
        return $("#run_status").html(mesg.output.done ? "" : "running...");
      });
    };
    $("#execute").button().click(function(e) {
      return execute_code();
    });
    $("body").keydown(function(e) {
      if (e.which === 13 && e.shiftKey) {
        execute_code();
        return false;
      }
    });
    $("#connection_status").html("connecting...");
    return salvus = new Salvus({
      on_login: function(name) {
        return sign_in(name);
      },
      onopen: function(protocol) {
        return $("#connection_status").html("connected (" + protocol + ")");
      },
      onclose: function() {
        return $("#connection_status").html("reconnecting...");
      }
    });
  });

}).call(this);
