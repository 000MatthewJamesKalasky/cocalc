set -e
set -v

# layout
export DEV=/dev/sdb
export MOUNT=/projects

# make all the partitions and mounts
mkfs.btrfs -f $DEV
mkdir -p $MOUNT 
mount -o compress-force=lzo,noatime $DEV $MOUNT
btrfs quota enable $MOUNT 
chmod og-rw $MOUNT 
chmod og+x $MOUNT 
btrfs subvolume create $MOUNT/conf 
chown salvus. $MOUNT/conf 
btrfs subvolume create $MOUNT/sagemathcloud 
btrfs subvolume create $MOUNT/.snapshots
sudo rsync -LrxH --delete /home/salvus/salvus/salvus/local_hub_template/ $MOUNT/sagemathcloud/ 

# inspect filesystems
df -h

