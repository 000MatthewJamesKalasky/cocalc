#!/usr/bin/env python

import os
cur_path = os.path.split(os.path.realpath(__file__))[0]

os.chdir(cur_path)

version = open("node_modules/salvus_version.js").read().split('=')[1].strip()

#### "--all" disables caching ####

import sys

if '--all' in sys.argv:
    all = True
    sys.argv.remove("--all")
else:
    all = False

##################################
# generate static/index.html

out = open("static/index.html","w")
## removed since this has to be after doctype...
## out.write("<!-- THIS FILE IS AUTOGENERATED BY gen_page !!! Edit the files in static/page instead. -->\n\n")

for X in open("page/index.html").readlines():
    if ".html" in X:
       out.write(open(os.path.join("page/", X.strip())).read().replace("__SALVUS_VERSION__",version))
    else:
       out.write(X)

os.chdir(cur_path)

### Calling wizard's makefile
if all:
    os.system("cd wizard && make -B")
else:
    os.system("cd wizard && make")

