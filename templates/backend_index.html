<!doctype html>
<html>
<head>
<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="socket.io.js"></script>
<script type="text/javascript" src="backend.js"></script>
<script type="text/javascript">

$(function() {

    $('#execute').click(execute_code);
    $('#input, div').css({'fontSize':'small', 'fontFamily':'Courier New'});
    $('body').keydown(function(event) { 
	if (event.which == 13 && event.shiftKey) {
	    execute_code();
	    return false;
	} else if (event.which == 67 && event.ctrlKey) {
	    sigint();
	    return false;
	}
    });

/*    var socket = sagews_backend.socket('http://' + window.location.host);

    function execute_code() { 
	$('#output')[0].innerHTML = '';
	socket.execute('0', $('#input').val(), 
		       function(s) { $('#output')[0].innerHTML += s; },
		       function(s) { if (s) { $('#output')[0].innerHTML += '[[' + s + ']]';}  },
		       function () { $('#output')[0].innerHTML += '(done)'; }
		      );
    }
  */  

    function walltime() { return (new Date()).getTime(); }

    var start_time;

    var options = {
	set:function(selector, value) {
	    $(selector)[0].innerHTML = value;
	},
	stdout:function(selector, output) {
	    $(selector)[0].innerHTML += output;
        },
	stderr:function(selector, output) {
	    $(selector)[0].innerHTML += output;
        },
	done:function(selector) {
	    $('#time')[0].innerHTML = (walltime() - start_time) + ' ms';
        }
    }

    var socket = sagews_backend.socket('http://' + window.location.host, options);

    function execute_code() { 
        start_time = walltime();
	$('#output')[0].innerHTML = '';
	var input=$('#input').val();
        /* set input if there are other clients (otherwise does nothing) */
	socket.set_other('#input', input);  
	socket.execute2('#output', input);
    }

})
</script>


<body>

<div id="runframe">
<pre>
<textarea id="input" name="code" rows=6 cols=80>
import random, sys, time
t = time.time()
for i in range(10): 
    print i
    sys.stdout.flush()
print time.time()-t
</textarea>
</pre>
</div>

<br>
<button id="execute">Execute (shift+enter)</button>
(<span id="time">0 ms</span>)

<pre id="output">
output here
</pre>

</body>
</html>
