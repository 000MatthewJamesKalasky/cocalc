# Next base image update:
  - [ ] GCE: verify that have fixed storage ssh key on salvus base image

# NEXT

 - [x] editor: go editor mode.


 - [ ] location autodetect by hub doesn't always work
 - [ ] "The Sagemath Cloud" --> SageMathCloud
 - [ ] get SMC in SMC working again
 - [ ] javascript hook to record the diff stream
 - [ ] preserve own choice of ssh private key for ssh server
 - [ ] snapshot time doesn't work in Firefox.
 - [ ] project server restart maybe isn't working?
 - [ ] remove the home images in servers from compute vm's and reboot each one
 - [ ] copy all the computex-home.img's to one computer to delete later.

 - [ ] start using cloud13 again


 - [ ] upgrade to sage 6.0

 - [ ] snap: delete snap cassandra user everywhere
 - [ ] bug: "%load foo.js"
 - [ ] route 53 dns instead of what I have now;
 - [ ] get google webserver updated (108.59.84.126) and added to dns.
 - [ ] make script for raising quota:
        s=require('storage'); s.init()
        s.quota(project_id:'b33ef4d2-fbf3-467a-a5ec-2ebc5033afec', size:'20G', cb:console.log)
 - [ ] put the /mnt/snap scripts from 10.1.1.3 somewhere good and use 'em, e.g., to repair db, scrub zfs.
 - [ ] implement automatic regular scrub of zfs.
 - [ ] port forwarding:
         ssh -L cloud1.math.washington.edu:4567:10.1.2.4:4567 ce2d267d00df42deab4464509a5f3e74@10.1.2.4


# DONE



TODO:

 - [x] make a new base vm and restart compute vm's using it.
 - [x] update gce base vm and re-create all compute vm's using it.  Could be issues
 - [x] re-install /root ssh
 - [x] in parallel
    - [x] do two migrates
    - [x] add option to migrate so it migrates project *and* sets location to null!
    - [x] more migrates

'f56643b6-e96d-4a73-83b2-cea7bd5298eb': { 'src-10.1.2.4-dest-10.1.6.4': 'destroyed target project -- cannot receive incremental stream: most recent snapshot of projects/f56643b6-e96d-4a73-83b2-
cea7bd5298eb does not\nmatch incremental source\n' },
     'dac4431b-1ed2-4c15-ae41-8a7dde4a8622

DO IT

 - [ ] migrate

 - [ ] in parallel

     - [ ] do another migrate, then set all to null:

         r=require('storage'); r.init()
         y={};r.migrate_all(limit:25000,cb:(a,b)->x.a=a;y.b=b)
         r.migrate_unset_all_locs(cb:console.log)

     - [ ] reboot all web vm's:

         [cloud.restart('vm',hostname='web%s'%i) for i in range(1,8) + range(10,22)]


 - [ ] start all hub servers and nginx servers

 - [ ] send an email; encourage testing and feedback about issues.


 - [x] (1:00?) a database field to disable project timeouts
 - [x] (1:30?) hub: implement automatic timeout when inactive, removing existing code; honor database field to ignore timeouts
 - [x] (0:30?) snap: disable in startup scripts...
 - [x] (0:45?) look at, try, new print script


- [x] (0:45?) bug: file chat broken by switch; it's an "open before file create" issue; touching file makes it work. Has to do with code for dealing with read-only files that I added.



- [x] come up with ideas for Sage Days 56:

 - make some use of GCE for sage dev (?)
 - organize bug days
 - triage bugs
 - online homework system
 - ideas for better use of snapshots:
     - tags like git; could be used in url, e.g.,  <https://cloud.sagemath.com/projects/af95e67e-809d-49b1-a323-5c7e441b06e5/tags/foobar/>
        - the tag would just be mapped to existing snapshot names; just a simple map in projects table.
        - user wouldn't be allowed to delete snapshot without big fat warning.
     - could have user-wide tags, which point to a specific version of a file/directory in a project:
         <https://cloud.sagemath.com/users/user_id/tags/foobar>
       (or when we have usernames, `user_id --> username`).  If foobar not given, would list all tags for that user.


 - user guidebook
 - marketing campaign ideas
     - blog post ideas
 - business ideas
     - early signup price (like google play): basically only way to get permanent discount
 - brainstorm ideas that are very fast because of using ZFS, e.g., clone/forking/etc.
 - Sage infrastructure discussions.
 - optimize (with Andrew) the file listing script



BUGS:
 - [ ] "open .git" from terminal fails
 - [ ] open often shows wrong tab


DONE:


- [ ] (2:00?) setup working SMC dev environment on vm... unless I run into a show-stopper issue with missing deps
       - [x] update database schema (used "git diff <commit_id> db_schema.cql")
       - [x] create projects zpool locally:
                - [x] shutdown vm
                - [x] add a new 16GB disk image
                - [x] setup compressed and dedup'd as zpool "projects":
                       zpool create -f projects /dev/sdb
                       zfs set dedup=on projects
                       zfs set compression=lz4 projects
                - [x] create storage user with sudo zfs access
                - [x] new script in /usr/local/bin/ (create_project_user.py)

       - [x] get a new project to work there
               - need to add to storage_topology table in db.
                   update storage_topology set vnodes=256 where data_center='0' and host='localhost';
       - [x] "git pull" a copy of my dev code to a new project

- [x] January SMC development log.
---------------------------
I'm on a flight to Hawaii, and I'm not going to get to do any real
SMC development with testing... because I used ZFS on a file on OS X,
and it DIED killing all my vm's when I stupidly (?) hard rebooted my
machine.
  Or NOT.  I couldn't import since they are already imported! Duh.!
  - update my smc plans, ideas, etc. a LOT
  - plan out course grading functionality



 - [x] GCE and libc issues
 - [x] debug: closing stale projects...
    Trace
        at exports.defaults (/home/salvus/salvus/salvus/node_modules/misc.js:65:15)
        at Object.exports.close_stale_projects (/home/salvus/salvus/salvus/node_modules/storage.js:616:12)
        at close_stale_projects (/home/salvus/salvus/salvus/node_modules/hub3.js:7009:20)
        at wrapper [as _onTimeout] (timers.js:252:14)
        at Timer.listOnTimeout [as ontimeout] (timers.js:110:15)
    /home/salvus/salvus/salvus/node_modules/misc.js:66
    w "misc.defaults -- TypeError: function takes inputs as an object " + (error()                                                                       ^
    misc.defaults -- TypeError: function takes inputs as an object (obj1=undefined, obj2={"ttl":86400,"dry_run":true,"limit":20,"cb":"__!!!!!!this is a required property!!!!!!__"})
 - [x] snap: delete the images on machines with low disk
 - [x] printing: add a line "\usepackage[utf8]{inputenc}" (after \usepackage{amsmath} ) the correct characters appears in the PDF generated by the print button: https://mail.google.com/mail/u/0/?shva=1#search/sagews2pdf/143539cb372003f5

