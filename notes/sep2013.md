- latex editor -- make space for the save spinner and sync... so the latex stuff doesn't get pushed... or moved save to the far right.

- 3.5 hours on Thu 09-26:
   - work mainly on SMCinSMC.
   x - copyright statement weirdness.
   - need to start using the new hardware!

- NEXT goal: make it so I can 100% do cloud development in cloud, i.e., make it so my "cloud.sagemath" project
  is a complete running copy of cloud, using some port forward.  Why:
      - snapshoting
      - aleviate my limited-memory laptop issues
      - collab.


   Critical issues:
    - [x] SMCinSMC -- get cassandra to run:
    Typing this before running it works:
        export MAX_HEAP_SIZE="4G"; export HEAP_NEWSIZE="800M"
    - [x] run haproxy without sudo.
    - [x] haproxy base url
    - [x] hub base url -- needs full testing, though.
    - [x] hub websocket url -- doesn't work
    - [x] project creation: only one project = self... but don't want to killall and restart (?):
          could do this via a hub option:   --
    - [x] the cookies may all conflict with cloud.sagemath.com ones, since the domain is the same -- prefix them with base_url?

    - [x] NOT -- MAYBE make it so projects can live in a subdirectory (*everything* is then in that subdirectory).
          This is complicated/will take a while/has possible value later/is a terrible idea!
          The problem is that processes, pkillall, etc., won't work.
          And it'll be hard, but just doesn't fit the model we have now.
          Instead, I should just make it so $HOME/.sagemathcloud is something different
          when there is a base url, so it gets its own version of code, sage server, local hub, etc.
          Ideas:
              .sagemathcloud-base_url (but with /'s replaced by -'s)
              .sagemathcloud-hash(base_url)
              .sagemathcloud-devel
              .sagemathcloud-project_id
          I like not using the base_url, because that depends on the port, which will be totally random.
          Using the project_id makes sense.
          The root path business could just be a *default* root path that you start at when you open
          a project...

     - [x] There is a ton of code that hardcodes .sagemathcloud, so first fix that to all use an environment variable.
          - make *everything* in project use this environ variable: SAGEMATHCLOUD
            except for sagemathcloud-env, which should use the path to where it is.
          - make everything in hub use either:
               - ~/.sagemathcloud or ~/.sagemathcloud-project_id if local=true in hub.
            (I ended up using .sagemathcloud-local instead)

    - [x] add base_url to info.json, so sage_server, ipython, etc., know the base_url.

    - [ ] salvus.file etc base url?  maybe not.
        Problem: I have to decide on where to put the base url.
          - in client --> will only cause trouble and complexity, but would be easy for worksheets
          - could just  'blobs/a.png?uuid=7df6bed7-ca59-42d1-9aa3-234048d5bc8e'
            instead of '/blobs/a.png?uuid=7df6bed7-ca59-42d1-9aa3-234048d5bc8e'
            but when we later support urls, so
               https://cloud.sagemath.com/project_id/path/to/worksheet/
            we would have to make
               https://cloud.sagemath.com/project_id/path/to/worksheet/blobs/foo?uuid=...
            work, which is *ambiguous*, hence not possible.
            So that's not an option long-term.
          - Changing the local_hub and sage_server to get a base_url parameter at startup (or via info.json) seems
            like the best plan longrun, but this means I have to make it so that projects can live in subdirectories first
            for SMCinSMC devel.

    - [ ] file download (in file browser) doesn't work yet (ignores base_url)

    - [ ] test/fix ipython (?)

    - [ ] need to explicitly do this when starting something (nginx?):
                 echo "salvus_base_url='/3702601d-9fbc-4e4e-b7ab-c10a79e34d3b/port/8389';" > salvus_base_url.js

    - [ ] nginx base url: currently hacking around a rewrite rule with symlink


   Stage 3:
    - make it so only have to specify base_url in one place in conf file.
    - project creation: only one project = self... but don't want to killall and restart (?)


   Stage 2 issue    - project creation: only one project = self... but don't want to killall and restart (?)

2 issue    - choose like 10 available ports on startup, and assign them all for various things -- low priority at start, but will be
      very, very important in the long run...
          running cassandra and getting access to port: may have to make them custom due to multiple projects on same machine


    - that cassandra is "wide open" -- need to implement auth


- [ ] 3d graphics --
     - [ ] aspect ratio
     - [ ] dynamically resizable
     - [ ] black background mode (then frame text defaults to white)
     - [ ] cached static image (?) -- not sure of the design for this, exactly
     - [ ] give back webgl context --as it is, I think we leak them or memory (?)
     - [ ] no axes labels/text when using canvas2d renderer?
           I should just use html -- then mathjax will work.
           See here: https://github.com/mrdoob/three.js/issues/1321
     - [ ] fix to work with newest three.js
     - [ ] export to the web... (self contained version)
     - [ ] line arrowhead
     - [ ] make sure camera control rotates us around center of frame, not origin!
     - [ ] no axes labels when using canvas2d renderer?
           I should just use html -- then mathjax will work.
           See here: https://github.com/mrdoob/three.js/issues/1321
     - [ ] systematically go through plots in docs (?)
     - [ ] objects in scene -- can identify each individual object by memory location (say):
            - change position, color, etc.
            - delete
            - change color, etc.
            - pick -- calls a python function


- [ ] *need* ping monitor for compute vm's

- [ ] grout bug -- (1,2,\n3) -- https://mail.google.com/mail/u/0/?shva=1#inbox/1412fc008a36e7ae



 - [ ] auto-javascript to render scene (for new clients) -- basically request info of scene from something (from DB or sage session?).
       could also request *either* a webgl or canvas2d version
       related -- if editor refreshes (?) -- then all 3d images vanish.

 - [ ] camera controls don't work right in canvas2d mode.
 - [ ] anti-aliasing doesn't work for me in webgl mode on chrome.

- [ ] interact function calling *still* broken/wrong -- see  2013-09-21-005758.sagews in scratch project.

--

[ ] when opening a new terminal, the cursor isn't visible until users types something.  This is un-nerving.
    [issue #6](https://github.com/williamstein/salvus/issues/6).

[ ] project status messages -- related to lock thing.

   - need status messages as we go, broadcast to all clients connected to that project
     via any hub:

         - project_server restart initiated
         - killing processes
         - rsyncing code
         - starting servers
         - working

     There is currently no mechanism to broadcast to all clients connected to a project.... unless
     that project server is running (in which case there would be).
     Hmm.  Catch 22.
     So only user that initiates restarts sees the above.
     Messages to any user connected (locally from that hub):

         - restart initiated (for whatever reason)
         - project is being restarted (lock file)
         - project is working

     Project server status: running /not running, should be clearly reflected in the UI, say
     in the color of the tab at the top, or project's own nav bar... ?

- [ ] <a href>, etc. processing in %md and %html modes -- https://mail.google.com/mail/u/0/?shva=1#inbox/14134dbd937864da

- [ ] "tofile" cell decorator functionality...: https://gist.github.com/williamstein/6630484 (wait for feedback?)

- [] no double click on mobile!

 - [] hard to get keyboard to appear on mobile

 - [] sync way less often on mobile.?


- [ ] BUG: debug: converting object of length 20754 to hex
debug: converted, now storing
debug: client --> hub (client=28230830-37c0-4c8a-94d6-a6c5086a8106): {"event":"codemirror_write_to_disk","session_uuid":"6a53e24d-dff1-45f5-b083-a797a7ceb632","id":"50ca49e7-a2c7-4583-8611-5eb36fc079f3"}
debug: converting object of length 20754 to hex
debug: converted, now storing
debug: hub --> client (client=28230830-37c0-4c8a-94d6-a6c5086a8106): {"event":"temporary_link_to_file_read_from_project","id":"7d8faeb3-defe-4492-9ef6-6f2cb2058d08","url":"/blobs/sin.png?uuid=786df908-210a-4781-af2c-9130bc090215"}
debug: Error parsing JSON message 'undefined'

/home/wstein/salvus/salvus/node_modules/misc_node.js:46
                throw e;
                      ^
SyntaxError: Unexpected token u
    at Object.parse (native)
    at Socket.exports.enable_mesg.socket._listen_for_mesg (/home/wstein/salvus/salvus/node_modules/misc_node.js:42:28)
    at Socket.EventEmitter.emit (events.js:126:20)
    at TCP.onread (net.js:397:14)
debug: Successfully registered with database.


- [ ] back to 3d graphics:

   - [ ] upgrade to latest version of Three.js:
      - [ ] fix that scene is messed up with newest code.
      - [ ] fix TrackballControls.js in newest version.
   - [ ] get rid of using tmp.js and setting window property to transfer the 3d scene.
   - [ ] html -- put a nice 3d template in 3d.html (+css?)
   - [ ] 2d canvas fallback renderer
   - [ ] axes lines
   - [ ] axes labels
   - [ ] disable render loop usually, so don't waste cpu
   - [ ] ability to directly manipulate objects in the scene easily from python
   - [ ] set initial camera position based on bounding box of the scene
   - [ ] guide user to actually enable accel 3d, since it does not *just work*, e.g.,
         chrome://flags then RESTART WHOLE BROWSER.
   - [ ] resizable (via a corner)

---


- [ ] firefox mobile tab complete fail.

- [ ] snap idea: continually refresh the lock file, so can time it out much more quickly in case of problems.

- [ ] change /etc/security/limits.conf somehow -- on cassandra/web nodes, needs to be big; on user nodes needs to be very limiting...

         This user: V |         S | vagrantstar.suaste@gmail.com
         on Gc1Canib@10.1.3.4
         project_id=c19e4f96-a443-4b02-8206-7669121d8f6a

         http://unix.stackexchange.com/questions/34334/how-to-create-a-user-with-limited-ram-usage

         At a minimum for user vm in limits.conf, put:

             * soft as 8000000
             * hard as 8000000
---


- [ ] Beezer wants: chat mathjax syntax: MathJax syntax:  My students need to use \(...\) syntax in WebWorK, so that is what they know (and I encourage).  Seems like the chat window only recognizes $...$.  If adding this alternate syntax was welcome, it is pretty easy to specify in the MathJax configuration options.  https://mail.google.com/mail/u/0/?shva=1#inbox/14124c92a52a1b68

- [ ] "type or paste input here" -- no longer selectable!  but maybe it should just vanish.

- [ ] 3d graphics (1-2 days): get something going based on the summer project.

- [ ] terminal -- sometimes it is too wide, i.e., characters get cut off horizontally...

- [ ] file listing pager -- see Johan's request: https://mail.google.com/mail/u/0/?shva=1#inbox/14084ff6be8769cf

- [ ] sync'ing, etc. causing files to re-appear

- [ ] terminal/tab bug found by harald:
            The following is a tiny bug, maybe related to this re-appearing of tabs when modifications happen?
            What I can do consistently:
            1. open an existing terminal.term file
            2. close it with "middle mouse click"
            3. go to recent.
            4. click on "clear"
            5. the terminal.term tab re-appears.
            The fun thing is, that's a ghost-like tab which doesn't do anything any more.
            Browser is FF.

- [ ] terminal -- open files from terminal

- [ ] password reset should require new password twice

- [ ] cancel the "error viewing files page" if we actually succeeded after a while with another request!

- [ ] robustness -- haproxy -- needs to auto-detect nginx goes down and use up one.

- [ ] term freeze bug still: there is a situation where hitting keys doesn't result anything getting sent to the hub, so things don't get fixed.  why?

- [ ] disable control-s flow control in terminals (?) -- so stupid and confusing.

---

- [ ] (0:20?) screencast: write a fortran program in the cloud -- after push out fortran mode.

- [ ] terminal: double check that closing a terminal (and file) stops any hub from sending messages/channel data/whatever about it!

- [ ] terminal burst protection: maybe not so good; revisit.

- [ ] vim-mode: control-c for copy only works in insert mode (not escape mode).


- [ ] terminal buffer in the *browser* needs to be limited as well.  Right now it can easily use up the memory of the browser.

- [ ] ipython in an iframe doesn't work with ie yet -- but in own server proxied does work fine.

- [ ] when project is loading could also put a spinner at the top (in the project tab).

- [ ] sws import fails for unicode: https://mail.google.com/mail/u/0/?shva=1#inbox/1410e48f9c632f66

- [ ] edit worksheet, don't save, do rename, do loose everything! --> properly implement file rename

- [ ] install gdb and valgrind, etc.

- [ ] salvus.file -- when showing image, make it resizable.

- [ ] salvus is updated -- please click here to restart your project server (or click here to not be notified until next upgrade).

- [ ] salvus project settings -- show last time started.

- [ ] when selecting files in the Files... page, highlight the first one, allow cursor to move highlight.

- [ ] terminal laundry list -- https://mail.google.com/mail/u/0/?shva=1#inbox/140fe5f00430f8a6

- [ ] proper delete file -- should close the sync thing everywhere and all open files.

- [ ] restarting project server should reconnect all the sessions.

- [ ] projet list -- be able to show only projects that have a given collaborator.

- [ ] chat logs -- always sort contents by date stamps.

- [ ] haproxy should load balance (equally) instead of round robin, since as is, things get very unbalanced.

- [ ] sync/save -- make damned sure that the latest version has sync'd all the way to the local hub before ack'ing a save -- just change the hub so that "save to disk" message from client only succeeds after the hub does a sync with local hub, then succeeds at save to disk. I.e., throw in one more sync.


- [ ] static file access

- [ ] martin raum's code: merge into psage (and make psage work!) -- https://mail.google.com/mail/u/0/?shva=1#inbox/14083cc5ad184463


- [ ] normalize the two python installs: https://mail.google.com/mail/u/0/?shva=1#search/cloud/140db22b7209c550

- [ ] suggestion: implement vim history -- https://mail.google.com/mail/u/0/?shva=1#inbox/13fdbf99ac9fd68c

- [ ] this in the log of a localhub where a file is suddenly appearing empty:

(node) warning: possible EventEmitter memory leak detected. 11 listeners added. Use emitter.setMaxListeners() to increase limit.
Trace
    at StatWatcher.EventEmitter.addListener (events.js:175:15)
    at Object.fs.watchFile (fs.js:945:8)
    at DiffSyncFile_server._start_watching_file (/mnt/home/QUFxIlqs/.sagemathcloud/node_modules/local_hub.js:593:17)
    at DiffSyncFile_server.__bind [as _start_watching_file] (/mnt/home/QUFxIlqs/.sagemathcloud/node_modules/local_hub.js:4:61)
    at DiffSyncFile_server.kill (/mnt/home/QUFxIlqs/.sagemathcloud/node_modules/local_hub.js:551:19)
    at fs.readFile (fs.js:176:14)
    at Object.oncomplete (fs.js:297:15)
error: Uncaught exception: Error: This socket is closed.


# Features

- [ ] ipython chat?

- [ ] list of blog posts about cloud somewhere?  http://www.highschoolmathandchess.com/2013/09/07/sagemath-cloud/


- [ ] middle/ctrl-click on project should open project in background tab.

- [ ] get rid of `remember_me` checkbox *and* delete the `remember_me` cookie whenever the user *explicitly* logs out.

- [ ] Josh Swanson's amazingly useful list of bugs -- https://mail.google.com/mail/u/0/?shva=1#search/josh/140c924d56bc80ce and also appended to and discussed at https://mail.google.com/mail/u/0/?shva=1#inbox/140cfdf29908115b

- [ ] .tex file appearing in the root directory -- https://mail.google.com/mail/u/0/?shva=1#inbox/140c6f31cfb5a9d2

- [ ] password reset bug --  https://mail.google.com/mail/u/0/?shva=1#inbox/140d0e2e20381ba1

- [ ] how to display plots in R? -- https://mail.google.com/mail/u/0/?shva=1#inbox/140c9b84390ca622

- [ ] sometimes files don't download; same with png page's -- I'm guessing this is the database wrote lag, which can be fixed by a client retry and/or caching in RAM in the hub the object for a minute (to avoid hitting db anyways, which would be a huge win!).
Nginx static file server could also address this nicely.

- [ ] how to display plots from octave? -- https://mail.google.com/mail/u/0/?shva=1#inbox/140caa1b991553a8

- [ ] using "+ New" on a file that is too large... just shows an error of "true"; note useful -- and might as well increase the timeout a lot and show status, etc.

- [ ] sweave support: https://mail.google.com/mail/u/0/?shva=1#inbox/140cb0fa4e8a2a38

- [ ] tons of swap (?)

- [ ] control-shift-o should show the last of files/recent/new used -- https://mail.google.com/mail/u/0/?shva=1#inbox/13f8df6166275c26

- [ ] latex editor -- would it be possible to have like the okular browse tool in the preview, so I can scroll by holding the mouse? -- see https://mail.google.com/mail/u/0/?shva=1#inbox/140c5c52cb423c6b

- [ ] > The automatic opening of the "recent" tab starts to annoy me … maybe I'm not
> alone with that observation? -- Harald;
Yes, that doesn't seem to be fixed after all.   I've seen it again too.   It must be another code path besides the one I fixed  before.

- [ ] latex bug -- sometimes pages come up blank due to not prop. to db yet -- fix is probably to just reget them -- https://mail.google.com/mail/u/0/?shva=1#inbox/140c5c52cb423c6b

- [ ] latex spell checking: just run through detex, then spell, then highlight all mispelled words.
      provide a way to add ok words to a dictionary (?)


- [ ] update interact with dynamic control location: https://mail.google.com/mail/u/0/?shva=1#inbox/140be247be8fac38

- [ ] dropbox sync

- [ ] There is currently no way to turn off the live preview.  That is a feature I'll add in a future version, and it shouldn't be hard to add it. Sorry about this regression.

- [ ] account creation -- when start requesting and get back error, need to tell user!!!  especially too many requests from ip; more generally just fix things so the ip address is right.

- [ ] latex editor bug -- removed pages at end don't get deleted.

- [ ] latex editor bug: need to allow horizontal scroll -- $(".salvus-editor-pdf-preview-page").css({"overflow-x":"scroll"}); harald says "scroll down here: http://api.jquery.com/scrollLeft/ there is some html in a fixed div with x offset. i hope that helps ;) (maybe there are other solutions, i'm not sure.)"

- [ ] latex editor feature ideas: get coords; also mag glass -- https://mail.google.com/mail/u/0/?shva=1#inbox/140c5c52cb423c6b

- [ ] latex editor idea -- can estimate time to run latex, etc., from the time it took last time, and show progress bars.

- [ ] pin cursor in editor to another user -- https://mail.google.com/mail/u/0/?shva=1#inbox/140c601e58bc61f0

- [ ] snap servers: sometimes they drop forever... why!

- [ ] make monitor do cloud.restart("snap") if number of snap servers drops.

- [ ] no way to paste from android to codemirror.

- [ ] android: cursor totally off sometimes

- [ ] closed tabs keep re-appearing very confusingly!!!!

- [ ] the case where sync fails (?): sends changes, doesn't get response, but in fact response went through.

- [ ] add to help page --  The asynchronous server code is all node.js (written in coffeescript).    Python is used for sage and also overall control/management of the distributed system.  The databases is Cassandra.  We use  bup for distributed de-depuplicated snapshots.  The vpn is tinc.  The virtual machines use kvm.  The client-side code is coffeescript plus dozens of third-party libraries such as CodeMirror.

- [ ] codemirror editors -- split line VERTICALLY -- would be super, super useful.

- [ ] order chat by time -- https://mail.google.com/mail/u/0/?shva=1#inbox/140b32b9493bfdc9

- [ ] closed tabs keep re-appearing very confusingly!!!!

- [ ] terminal -- make "refresh" button reconnect... to see how robust (?)

- [ ] large number of files in a directory page

- [ ] user ability to reset all "remember me" cookies

- [ ] keyboard shortcut to cycle through open tabs


- [ ] Sublime cursor movement "get unlost" -- http://aspirecode.com/sublime-text-jump-back-jump-forward/
        - add forward/back buttons to left of "Files"
        - add project-level variable that is:
              - an array of objects {filename:'...', pos:?},
              - a pointer into array
        - events (show?) will add things to array,
        - clicking back button

---


- MAJOR ISSUE: if a bunch of restart project attempts happen, then the hub doing the restarting renders
  that entire project un-restartable, since it is too impatient (e.g., 10 second timeout).  FIX THIS and restart
  all the hubs.

- add field text for account creation.

Issues to fix with latex editing:

- [ ] the spinner is unberable; just get rid of it ?
- [ ] sometimes it doesn't come up at first and scrollbar is on left -- size issue?
- [ ] side-by-side would be very useful...
- [ ] make pdf itself wider (?) -- have a button







- [ ] do not send broadcast when my cursor moves as a result of somebody else's actions.

- [ ] use the "update now" style notification when websocket drops / restores (?)

-----
- [ ] client doesn't do anything sensible in response to this from hub:
debug: hub --> client (client=653426d1-2ccc-4027-b1b3-da44eb3119ed): {"event":"error","id":"2bd05e47-887b-4681-a390-e9fe9133c4af","error":"user must be signed in before accessing projects"}

- [ ] UX: progress bars!  http://ricostacruz.com/nprogress/   -- should even have worksheet salvus. api!

- [ ] UX idea -- if the mouse is *moving* don't refresh the directory listing!


- [ ] why does log list this twice:
debug: opts = {"project_id":"54949eee-57da-4bd7-bb43-c2602b429f9a","account_id":"25e2cae4-05c7-4c28-ae22-1e6d3d2e8bb5"}
debug: local_hub --> global_hub: received a blob with uuid d24f0b9f-fd24-49d4-8dc1-d579142b818c
debug: converting object of length 7898552 to hex
debug: converted, now storing
debug: converting object of length 7898552 to hex
debug: converted, now storing

- [ ] image viewer refresh button; trivial,  might as well

- [ ] upgrade  to  bootstrap 3: see <http://code.divshot.com/bootstrap3_upgrader/>

- [ ] a release at some point
      - upgrade haproxy in edge nodes


- [ ] maybe the mouse down versus middle click changes I made make it so clicking on a directory double selects, which looks stupid.

- [ ] publicly accessible projects (?)

- [ ] write another help section on something

- [ ] user database


---
Ideas:

- [ ] in syncdoc:
                    # TODO -- this will work when the hub
                    # makes each client session work independently instead of locking them all together...
                    #@session_uuid = mesg.mesg.new_session_uuid

- [ ] use http://www.bootstrap-switch.org/ to provide a toggle of this style when viewing images: max-width: 100%;

- [ ] the Recent display is coming up empty again often.

- [ ] overwriting uploaded files: https://mail.google.com/mail/u/0/?shva=1#starred/14085f02020549a8

- [ ] popup on *new* chat message; indicator of unseen chats.

- [ ] test ipad + chrome + external keyboard: https://mail.google.com/mail/u/0/?shva=1#starred/14080562e3a0b444


- [ ] put an x in top right of search box for projects.

- [ ] database for all users?

- [ ] +1 what other people do or comments in logs...  it just seems to be an instinct to have this :-)

- [ ] add search box to project log (and also to

- [ ] do not allow opening files over 1mb without a stern warning

- [ ] editing rst files is totally broken!

- [ ] teaching / course management system....

- [ ] bug in find in cloud.sagemath code editor (codemirror?):
       search for "incorretly" in the raw file version of http://trac.sagemath.org/attachment/ticket/15013/trac_15013_logic_docstrings.patch

- [ ] change snap/bup usage to not cross filesystem boundaries (?), so won't back up encfs-mounted directories.

- [ ] Add to FAQ how to use encfs and that these aren't snapshoted, and that terminal i/o isn't recorded.

- [ ] (1:00?) doing "salvus.file(filename)" yields a link
      pdf/database.pdf (this temporary link expires in a minute)
      but it's not a minute anymore -- the default is a day, or may depend on size -- use the info in the object itself..

- [ ] (1:00?) fix terminal on "not working"

- [ ] (1:00?) file rename gui seems broken...

- [ ] the hub logs are all filled with messages like this:

  local_hub --> hub: (connect) error -- true, _new_session: sage session denied connection: Error: connect ECONNREFUSED


- [ ] sync in the global hub is not optimally implemented, since there is no reason to every force the client to retry their sync if there is 1a connection to the global hub.  Instead of having one single shared locked state for the global hub version of the doc, could have lots.

- [ ] if ssh to remote fails, hub goes into a crazy spin; need to use my retry exponential backoff and stop after n tries!

- [ ] (2:00?) project high availability -- keep thinking about this!


- [ ] (1:00?) move FAQ from github into cloud itself.

- [ ] ((0:30?) add this to FAQ: https://mail.google.com/mail/u/0/?shva=1#inbox/1406489d11dac03e

- [ ] (1:00?) salvus.blob to send info without needing to create a file at all

- [ ] (1:00?) change salvus.javascript to send obj using salvus.blob and $.ajax.

- [ ] (1:30?) see misc project sws2sagews.py -- the DATA directory thing is not done

- [ ] Need to figure out how to use ssh passphrase, at some point.

- [ ] (1:30?) make it so clicking on a zip/tar/etc. file in the file browser extracts it instead of trying to open the underlying file in codemirror.

- [ ] (1:30?) make a screencast illustrating migrating worksheets from sagenb.:  harald says: "+1 same for: author latex documents, run sagetex, etc. ad ipython notebook tranformation:"


---

- [ ] bug in tex -- hangs forever -- get this in output (use  pdflatex table2.tex </dev/null to fixo fix?).

        /usr/share/texmf-texlive/tex/latex/memoir/mempatch.sty))
        (/usr/share/texmf-texlive/tex/xelatex/fontspec/fontspec.sty
        !
         ********************************************
         * XeTeX is required to compile this document.
         * Sorry!
         ********************************************.
        \RequireXeTeX ...********************************}
                                                          \endgroup \fi


- [ ] try to share code between project chat and file chat -- refactor it so it is the same.

- [ ] for published projects, if the URL is not indexed, spammers get nothing.

- [ ] for browsing published projects, do it sort of like g+/facebook, and try to provide a feed of things likely to be interesting to a particular user.  And provide a "mark as spam".

- [ ] database -- doing `select *``in cassandra does not scale at all.  I must find all instances of that and replace by a dummy or merge tables to have a fake compound primary key.

- [ ] make document chat use synchronized string.



- [ ] move improvements to abstractsyncdoc to also apply to hub
- [ ] move improvements to abstractsyncdoc to also apply to local hub


- [ ] spinner when loading log (?)
- [ ] "failed to create sockjs connection; try again" -- should do exponential backoff...?



- [ ] (2:00?) ui improvement suggestions from Nathan Carter:

5        If you're thinking about those dialog boxes, I'll add two other less important design observations:
                1. Pressing enter doesn't submit the form.
                2. Clicking the submit button doesn't give any immediate visible feedback that you did so (e.g., grey out the Sign In button), so if it takes a few seconds to get anywhere, you wonder if you really clicked it, and sometimes click again.


- [ ] (1:00?) save fail -- GUI doesn't produce any useful error message or even warning.  in this case restarting local hub fixed problem.
_ack":1}
debug: client --> hub: {"event":"codemirror_write_to_disk","session_uuid":"4c7556bb-3c64-4301-b515-99fde1481e4f","id":"a465228c-3ec2-42c8-ae1f-7edc4e27c8fd"}
debug: hub --> client (992e6b83-17fa-4d43-bcc5-aa78160973e4): {"event":"reconnect","id":"a465228c-3ec2-42c8-ae1f-7edc4e27c8fd","reason":"Error writing to disk -- true"}
debug: codemirror session sync -- pushed edits, thus completing cycle


- [ ] (4:00?) global system-wide chat.  I want it, so I can post about what I'm working on!

- [ ] (3:00?) integrate word cloud functionality (mainly for tish thesis... but maybe more): https://github.com/jasondavies/d3-cloud

- [ ] (1:30?) fix copy paste in terminal in firefox.

- [ ] (1:00?) trigger reload of user site packages -- https://mail.google.com/mail/u/0/?shva=1#inbox/1403fa803090d5b8

- [ ] (1:00?) install these in compute vm's -- https://mail.google.com/mail/ca/u/0/#inbox/1404104d0535fa46esday

- [ ] (1:00?) "When i click the play (▶) button on a cell, the cursor is lost (at least, here in FF)." -- https://mail.google.com/mail/u/0/?shva=1#search/sage-cloud/1404e1b3aa12fd89

- [ ] (1:00?) "Related to that, I propose that ALT+▶ does the same as ALT+RETURN, i.e. keep the cursor where it is – and also to mention that in the balloon help."   https://mail.google.com/mail/u/0/?shva=1#search/sage-cloud/1404e1b3aa12fd89

- [ ] (1:00?) polish control-; behavior. https://mail.google.com/mail/u/0/?shva=1#search/sage-cloud/14049e4cbf217036

- [ ] (3:00?) log improvements ideas -- https://mail.google.com/mail/u/0/?shva=1#search/sage-cloud/14048048587b483b
      - project server restart
      - sage server restart

- [ ] (0:45?) turn ugly code like "timer = setTimeout( (() -> project_list_spinner.show().spin()), 500 )" into a jquery plugin.

- [ ] ideal -- word cloud of opened files.


---

- [ ] (1:00?) syncdocs sometimes freeze -- maybe need a try/catch I don't know.

- [ ] (6:00?) ?? community tab: a system-wide chatroom that all connected users can use to chat (math enabled)

- [ ] (1:00?) snap: make snap lock more robust; IDEA -- if there is a lock of a certain age (?), check if that user is running any bups; if not, delete lock ?

- [ ] (1:00?) crontabs: https://mail.google.com/mail/u/0/?shva=1#inbox/14010044719e83b3

- [ ] (1:00?) serious synchronization bug/issue: when a worksheet gets updated, sometimes it is made visible, even if that tab is in the background.  CONFUSING!

- [ ] (1:00?) project storage ui polish: add html for all three project states: stored, restoring, active with tooltips explaining them; make html for this clean; make each "lighten" class.; color codes

- [ ] (1:00?) hub: implement `snapshot_project` function (and make sure to change number of copies for delete to 1 on localhost).

- [ ] (1:00?) write code in hub that periodically moves older projects to storage.  Maybe have to modify db schema to make this efficient, e.g., only ever look at projects that are not in storage.  Have two modes: a slower one that iterates over all projects, and one that takes project that were active in the last *month*, but not in the last week, and shelves only those.  Run on all hubs -- at a randomized interval, and iterating over the projects in a random order.

- [ ] (1:00?) hub:  for each Project/LocalHub class in global hub, check every 30 minutes to ensure that it is actively being modified.  If not, collect it.  This is critical, since we absolutely can't have a Project/LocalHub class sitting around in some hub when we move that project to storage.  Also, it avoids memory leaks.

- [ ] (2:00?) snap: UI for seeing nearest snapshot to a chat (just a link for now)

- [ ] (1:30?) write code in hub that ensures local hubs are always pre-started up for projects that have been accessed in the last week (again, a ttl'd new db schema field would do this).

- [ ] (2:00?) ulimit individual projects -- on july 22 one VM became unusable due to running out of memory, etc.

- [ ] (3:00?) (0:43+) "invite a friend" easy way to invite somebody else to get an account when sharing projects
  - page: design&implement the dialog where the user composes the message to friend
  - hub?: need to make it so 'https://cloud.sagemath.com/signup' immediately displays the "create an account" page.
  - hub: need to add a db table of "signup triggers", e.g., actions that happen when a particular email address is signed up, e.g., getting added to a project, banned, etc. -- should work with `email+*@'s`

- [ ] (1:30?) security issue -- should probably remove `/home/salvus/.ssh/id_rsa` from compute salvus on boot... since this grants access to other machines.  On the other hand, be careful since this is needed for making new projects the way I do now.

# Growth features

- [ ] (3:00?) templates -- https://mail.google.com/mail/u/0/?shva=1#inbox/140073638f4efd87

# User Visible Bugs

- [ ] (1:00?) reduce the terminal output rate-limitation thresh-hold -- it is ANNOYING or buggy when using top.

- [ ] (1:00?) (0:40+) strip "sage:" prompts from input blocks like in sagenb.org and command line; this makes copying code from docstrings much easier, etc.

- [ ] (1:00?) tab completion bug: edge case -- https://mail.google.com/mail/u/0/?shva=1#search/sage-cloud/14004a6da697a304

- [ ] (0:30?) creating a new cell should always scroll that cell into view, but often doesn't.

- [ ] (1:00?) highlight some blank space at bottom and do "shift-enter" -- get lots of new empty cells.

- [ ] (2:00?) optimize computation of diffs for synchronized document editing when there is a long line; right now, every time it diffs the entire doc.  If there is a single huge line of output -- e.g., take july2013-push.md and render it using md in a worksheet, so we get a huge single line of output -- then suddenly things feel very slow.
- [ ] (1:00?) if "Recent" tab is open and you switch project tabs, then switch back, sometimes Recent looks empty (seen many times, not sure how to replicate)
- [ ] (0:45?) on reconnect, sync all synchronized docs with hub (just like we do with fixing terminals).
- [ ] (2:00?) rename/copy/move a file:  'Something my students have complained about: after clicking an "Rename file", a box appears around the name of the file.  It is then tempting to click inside of that box (or triple click, even), but if you try this, you are taken to the file itself.  I was confused by this behavior at first, too.  It would perhaps at least be nice if after clicking on "Rename file", there was an easy way to delete the long default file name. ' (Dave Perkinson)
- [ ] (2:00?) improve how search in a doc works!  -- https://mail.google.com/mail/u/0/?shva=1#inbox/13ff8a0b89d4684a
- [ ] (1:30?) terminal -- firefox copy/paste (requested by everybody)
- [ ] (1:00?) first sync still confusing -- deletes stuff on first save (?); throw in a first save?
- [ ] (0:30?) Still some mathjax + markdown issues... e.g.,  This doesn't work
    %md
    $$\{ foo \}$$
    even though this does
    %md
    $\{ foo \}$
    \[
       \{ foo \}
    \]
- [ ] (1:30?) terminal reconnect -- works fine on browser reconnect, but fails on dropped connection, since I didn't implement that yet.


- [ ] (1:00?) fulltext search: for output lines, double check each result and make sure search term isn't in uuid
- [ ] (1:00?) on connection reset, force all open documents to sync.
- [ ] (1:00?) UI: renaming a long filename doesn't work.
- [ ] (1:00?) UI/client: warn before opening huge files... (recommend vim/emacs... or implement something that streams?)
- [ ] (0:45?) BUG: clearing the "recent files" list makes it so none of the open file tabs at the top of the screen work anymore.
- [ ] (1:00?) markdown -- there is no way to just insert a $.  Make \$ just $ without math....? somehow.
- [ ] (1:00?) search should not include hidden files by default....
- [ ] (1:00?) client.exec is timing out after about 10 seconds no matter what.  This messes up "disk usage", among other things...  I wonder why?
- [ ] (1:00?) show(animate) doesn't work
- [ ] (1:00?) when user exits terminal, restart terminal automatically... when they hit a key?
- [ ] (1:00?) update codemirror display more, e.g., after making output.  see https://groups.google.com/forum/#!topic/codemirror/aYpevIzBUYk
- [ ] (1:00?) BUG -- downloading a file that starts with "." removes the ".".
- [ ] (1:00?) %md -- make all links open in a new window
- [ ] (0:45?) "Latex Log" --> "Latex"; also the icons are wrong: icon-refresh should be "eye", and refresh should be next to latex.
- [ ] (1:00?) move recent files (etc.) thing to the database; it's too frustrating/confusing tieing this to the client computer.
- [ ] (1:00?) code execution needs another state: "w" for waiting.  E.g., 2 cells, one with sleep(5) and the next with sleep(5) make this clear.
- [ ] (1:00?) BUG: click on a 15MB tarball by accident via the file manager, and local hub breaks, and file never comes up; no way to recover (except restart hub?)
- [ ] (1:00?) when using an interact on cloud.sagemath.com that produces graphics (lecture 17 of 308), I'm seeing the image in output not appearing with some probability.  I'm guessing this has to do with how files get sent from local hub to hub, and there being multiple global hubs... and them not using the database always.
- [ ] (1:00?) see graph.sagews in "clarita thesis" project; sometimes the d3 graph doesn't display with a syntax error
- [ ] (0:30?) %hideall doesn't hide output, but should.
- [ ] (0:45?) sagews: javascript(once=True) isn't respected; needs to use a different channel... (broadcast?)
- [ ] (1:00?) sagews bug -- html.iframe gets updated/refreshed on all executes. why?
- [ ] (0:10?) syncdoc: remove "click_save_button:" from syncdoc.coffee, in case it is not used (I think it isn't).
- [ ] (1:00?) don't allow editing a file if it is above a certain relatively small size (at least, give a warning)
- [ ] (1:00?) BUG in sage execute: "divide into blocks" to respect code decorators, plus fix ugly recombination of if/while/etc.
- [ ] (0:45?) BUG: os x "control-o" should also accept command-o
- [ ] (0:30?) update the salvus.file docstring with current TTL parameters.
- [ ] (0:45?) worksheet: highlighting many cells and pressing shift-enter results in many new cells
- [ ] (1:00?) bug in block parser -- https://mail.google.com/mail/u/0/?shva=1#inbox/13f21ec599d17921
- [ ] (0:20?) tooltips on delete project and public/private look wrong (not bootstraped)
- [ ] (1:15?) get rid of 0=disable autosave; very dangerous.
- [ ] (0:45?) MAYBE -- when adding blank lines at bottom, if cursor is at *very* bottom and backspace, it can be confusing.




# User Features

- [ ] (2:00?) write a simple ipynb --> sagews convertor, since it is so similar to above and easier.
      See my worksheet in tmp/.
      Make it so clicking does automatic conversion.
- [ ] (2:00?) account settings: keyboard shortcuts
- [ ] (1:00?) display last computed usage for each project in project page, along with global total usage
- [ ] (0:45?) create a cell decorator "%typeset" that typesets output for only that cell using `typeset_mode(1)`
- [ ] (1:30?) terminal -- a "history" button; click it and get a popup (?) that contains the current terminal history; can be select-all'd.
- [ ] (1:00?) global default for file order mode.
- [ ] (1:30?) select block of code and comment / uncomment
- [ ] (1:30?) shortcut to switch between open files in projects: Control+Alt+Arrow or Shift+Command+Arrow (on OS X)
- [ ] (1:30?) search filenames only -- https://mail.google.com/mail/u/0/?shva=1#inbox/13fe8775dac2a83b
- [ ] (1:00?) pdf viewer -- should have link to download pdf.
- [ ] (1:00?) 3d: enable and test three.js's canvas fallback rendering
- [ ] (1:30?) way to star projects; show the starred ones first
- [ ] (1:30?) way to star files; show the starred ones first
- [ ] (1:00?) make it so settings autosave; get rid of confusing "save"/cancel buttons, since they only do certain things...
- [ ] (1:00?) snap: ability to *download* files directly from snapshots
- [ ] (1:00?) snap: preview file when clicked on
- [ ] (1:30?) new project default git and default config based on project creator (?)
- [ ] (1:00?) make it so "create a new file" allows you to just paste a URL in the filename blank... to get a file from the web; much simpler!
- [ ] (2:00?) image/pdf file change auto-update (due to frequent requests from users)
- [ ] (3:00?) copying/move file/directory *between* projects -- see https://mail.google.com/mail/u/0/?shva=1#search/sage-cloud/13ff5f8838de4834
- [ ] (1:00?) display docstrings formatted using sphinx (look at how we did this in sagenb)
- [ ] (0:30?) make it so the Restart... buttons are formatted like the delete/private buttons just to the right.

# Major new features

- [ ] (3:00?) read-only viewers of projects (like collab, but read only)
- [ ] (3:00?) sagews html editing: try using tinymce to edit %html cells -- editing the output would modify the input (but keep hidden ?)  NEW release! http://www.tinymce.com;  codemirror intro -- https://mail.google.com/mail/u/0/?shva=1#starred/13f5b853999289dc


# Server Bugs and issues

- [ ] (1:00?) snap: optimize this 'debug: finished recording snap_modified_files for project 5a986d67-833b-4f34-91a4-d084fdbf3159, time = 4.772000074386597' by putting it in a single transaction.

- [ ] (1:00?) admin: the `compute_server` database table is only done purely manually, but should be automatic based on something in services file.

- [ ] (1:00?) hub: need to clear `_local_hub_cache` if it isn't active for a while; this is important for when projects get de-allocate from disk.

- [ ] (2:00?) salvus.file python function should not return until all object is written to the database, etc.; also, give an error if file too big, etc.
- [ ] (2:00?) need to auto-kill `_project_cache` entries after some inactivity; same for `local_hub` objects.
- [ ] (2:00?) local hub reconnect issue -- see the log for web1 and this email -- https://mail.google.com/mail/u/0/?shva=1#sent/13fea00fb602fa13
- [ ] (2:00?) enable quotas (10GB/project)
- [ ] (2:00?) hub -- ensure connection to diffsync sessions is secure in that even if the sessionid is known by attacker, they can't use it.
- [ ] (1:30?) ping appeared slow and I saw this on the client... -- I wonder if the slow ping I was seeing the other day was only for *ME*?:
        Error in event handler for 'undefined': Cannot read property 'settings' of undefined TypeError: Cannot read property 'settings' of undefined
            at chrome-extension://gighmmpiobklfepjocnamgkkbiglidom/adblock_start_common.js:176:13
            at <error: illegal access>
            at Event.dispatchToListener (event_bindings:356:21)
            at Event.dispatch_ (event_bindings:342:27)
            at Event.dispatch (event_bindings:362:17)
            at Object.chromeHidden.Port.dispatchOnDisconnect (miscellaneous_bindings:258:27) [VM] event_bindings (27):346
        Event.dispatch_ [VM] event_bindings (27):346
        connection is not working... attempting to fix. salvus.min.js:6
        SockJS connection just closed, so trying to make a new one... salvus.min.js:6
        connection is not working... attempting to fix. salvus.min.js:6
        SockJS connection just closed, so trying to make a new one... salvus.min.js:6
        error Timeout after 90 seconds index.min.js:7
        console.trace() salvus.min.js:5
        exports.defaults salvus.min.js:5
        Uncaught misc.defaults -- TypeError: property 'account_id' must be specified: (obj1={"project_id":"de12e703-05c9-4c8c-9ae0-75a9c0063a8a"}, obj2={"project_id":"__!!!!!!this is a required property!!!!!!__","account_id":"__!!!!!!this is a required property!!!!!!__"}) salvus.min.js:5
- [ ] (1:30?) this was happening:
        Trace
            at exports.defaults (/home/salvus/salvus/salvus/node_modules/misc.js:66:19)
            at save_blob (/home/salvus/salvus/salvus/node_modules/hub.js:5237:12)
            at project.read_file.cb (/home/salvus/salvus/salvus/node_modules/hub.js:1560:22)
            at /home/salvus/salvus/salvus/node_modules/hub.js:3563:18
            at /home/salvus/salvus/salvus/node_modules/async/lib/async.js:226:13
            at /home/salvus/salvus/salvus/node_modules/async/lib/async.js:136:25
            at /home/salvus/salvus/salvus/node_modules/async/lib/async.js:223:17
            at /home/salvus/salvus/salvus/node_modules/async/lib/async.js:550:34
            at Object.socket.recv_mesg.cb (/home/salvus/salvus/salvus/node_modules/hub.js:3555:22)
            at timeout [as _onTimeout] (/home/salvus/salvus/salvus/node_modules/misc_node.js:122:25)
        debug: BUG ****************************************************************************
        debug: Uncaught exception: misc.defaults -- TypeError: property 'value' must be specified: (obj1={"uuid":"ff784074-2b1b-4e93-8c23-7148dd5a322a","ttl":86400}, obj2={"value":"__!!!!!!this is a required property!!!!!!__","cb":"__!!!!!!this is a required property!!!!!!__"})
        debug: Error
        (I changed the code to turn it into a log message error, instead of total death.)
- [ ] (2:00?)  `local_hub`: pushes out output *too* often/quickly; make a for loop and can easily kill the browser with sync requests.
- [ ] (1:00?) when database gets slow/unavailable, the snap servers stop registering... due to not catching an exception!

- [ ] (4:00?) the function `snap_command_ls` in the hub doesn't scale past 10,000 commits -- it'll just start ignoring snapshots when they exceed a certain number.  This is obviously sort of good, since we don't want to return too massive of a list.  I will have to come up with a more scalable plan for obtaining and displaying this info.  This returns about 1400 right now (for my main project):

        select count(*) from snap_commits where project_id=3702601d-9fbc-4e4e-b7ab-c10a79e34d3b and server_id in (c8f7e17d-c4d9-4fb8-9df4-b147981d4364,041bb4e5-7423-442b-b28c-46d5c5212b77, 61a7d705-8c7d-47a5-ab10-2f62de36bc6b, 1ce2577a-b065-4f70-870a-ae8395a15ffe);


# Server Features

- [ ] (1:30?) snap:  write code to switch automatically to new bup repo in a snap when things "get slow".  But when is that?  *WHEN number of commits hits about 4000* (switching is as simple as removing the file "active")

# Operations

- [ ] (1:00?) admin -- make it so the services file can have variables so I don't have to change the same base in a million places.
- [ ] (1:30?) upgrade to cassandra 1.2.6: <http://www.datastax.com/documentation/cassandra/1.2/index.html#cassandra/install/installDeb_t.html>
- [ ] (1:30?) build: automated tests to confirm that salvus environment doesn't suck: https://mail.google.com/mail/u/0/?shva=1#starred/13e690cc3464efb4
- [ ] (1:30?) (0:12+) use backup.coffee to make a regular text dump of complete db (except maybe blobs?)
- [ ] (1:30?) expand the size of the base vm, so I can start keeping all past builds of sage.
- [ ] (1:30?) monitor: function that monitors available disk space, memory, cpu load, etc. on all nodes, and includes that in a db table, which gets queried by the "stats/" URL.  This will be a database entry with ttl.   The "stats/" data will at some point get "visualized" using d3.   http://www.linuxexplorers.com/2012/08/linux-commands-to-check-cpu-and-memory-usage/
- [ ] (2:00?) swap: implement - swap space for VM's
- [ ] (2:00?) log aggregation: automatically and regularly copy log files to a central location (i'm constantly loosing super-useful logs!)



---



# User Visible Bugs

- [ ] (3:00?) improve css styles for dark themes, especially for mathjax -- https://mail.google.com/mail/u/0/?shva=1#search/sage-cloud/1400483ec22a8992
- [ ] (2:00?) the docstring popup is ugly and painful -- https://mail.google.com/mail/u/0/?shva=1#starred/140127ce418cbfff
- [ ] (1:30?) %prun profiler is now broken; just shows nonsense.
- [ ] (1:30?) sync/worksheets infinite loop printout in worksheet kills everything... NEED rate limiting of burst output, etc., like for terminals.

- [ ] (1:30?) mathjax (?) bug: BROWSER HANG
        var('P a b R T V_m')
        s = solve((((P - (a/V_m^2)) * (V_m-b)) / (R*T)) == 1, V_m)
        show(s)
        # then try to do "print s"
- [ ] (1:30?) right click to copy from a worksheet in Firefox (OS X) doesn't work, often "copy" doesn't show up in the menu, though keyboard shortcut still works.
- [ ] (1:00?) terminal -- fact control-shift-minus works in emacs codemirror mode (in app), so it must be possible to intercept it in javascript app for chrome after all(?)
- [ ] (0:30?) this interact doesn't work: `interacts.geometry.unit_circle()`
- [ ] (2:00?) terminal copy/paste; try to find a way to strip trailing whitespace, and deal with long lines (?)
- [ ] (1:00?) when searching again, keep the last search in the input box
- [ ] (1:00?) %load on a file with a syntax error gives a useless error message
- [ ] (1:00?) mobile worksheets: change how new cell insert acts to be actually usable!

- [ ] (2:00?) trying to download a large file (even 5MB!) can lead to disaster, e.g., rh.pdf from books project.  The google drive download setup looks nice; they make a temporary zip of the files, then email you a link -- maybe I could do that. (Of course, their's is frickin' broken due to a redirect loop on chrome.)


- [ ] (1:30?) converting the large cassandra12.pdf to png's to display in browser silently fails; probably a timeout (?)
- [ ] (1:30?) firefox (linux) -- both copy and paste with terminal are completely broken
- [ ] (1:00?) firefox recent files list -- pills wrong size
- [ ] (1:00?) firefox terminal -- resizes all wrong; bottom lines chopped... sometimes.  But sometimes fine. (maybe fixed)
- [ ] (1:00?) (0:13+) bug -- open a pdf then hit space -- you get back to the file search -- should go to next page.
- [ ] (1:30?) psage -- broken and doesn't build with sage-5.10, because of updates to Cython: "sqrt5_fast.pyx:1057:20: undeclared name not builtin: Py_GE"  (add psage to build.py todo list!)
- [ ] (1:30?) if during a session one had a websocket connection and it switches to something else upon reconnect, try to reconnect again after a minute or two.
- [ ] (1:00?) client.exec is timing out after about 10 seconds no matter what.  This messes up "disk usage", among other things...  I wonder why?   I think this leads to "Disk: (timed out running 'du -sch .')" when looking at larger projects.
- [ ] (1:00?) ui: if ping time hasn't been updated in a certain amount of time, replace by "..." (?)
- [ ] (0:45?) BUG -- latex output log -- isn't properly sized relative to container.
- [ ] (0:45?) sometimes file listing gets updated after we've already changed to another directory!
- [ ] (1:00?) something didn't get properly (monkey) patched:  sage.interacts.algebra.polar_prime_spiral()
- [ ] (0:45?) sagews: eliminate jquery countdown... (?)
- [ ] (0:45?) mathjax special case: `$a< [no space]b$` is misparsed, whereas `$a < b$` is OK.  We should somehow fix such things in the html function, since mathjax can't.
- [ ] (1:30?) this doesn't work:   GraphDatabase().interactive_query(display_cols=['graph6','num_vertices','degree_sequence'],num_vertices=['<=',4],min_degree=2)
- [ ] (1:30?) idea from Dan Grayson: Another feature of the sage math cloud would be compatibility with chrome's excellent scheme for keeping track of your user names and passwords for you. -- https://mail.google.com/mail/u/0/?shva=1#inbox/13ea4bfe65bc36cd
- [ ] (1:00?) BUG: after pasting something big in terminal paste blank, page gets scrolled up all wrong.
- [ ] (1:00?) BUG: file browser destroys long filenames now.
- [ ] (1:00?) in solarized light mode, markdown bold is too light to read.

# User Features

- [ ] (2:00?) customizable cursor
- [ ] (2:00?) implement ability to open files in the .snapshot directory (or anywhere) read only -- using a full editor view (but in codemirror read-only mode); does *not* require that the project is deployed.
- [ ] (2:00?) snap: restore target; allow the user to specify a given target path
- [ ] (2:00?) 3d: support for mtl files and colors -- see cloud project.
- [ ] (3:00?) snap: make it possible to optionally restore to a different location, which could be any path in *any project*.  This would make it possible to easily merge/move/etc. data from one project to another, and would not be hard to implement.
- [ ] (3:00?) terminal: implement an "open" command, via some sort of message.
- [ ] (1:15?) editor tabs: icons next to each filename
- [ ] (1:30?) feature: run sagetex automatically if needed

- [ ] (4:00?) make snaps a filesystem: http://sourceforge.net/apps/mediawiki/fuse/index.php?title=SimpleFilesystemHowto
      i.e., fuse mount snapshot path so is accessable read only in term. (?)
- [ ] (1:00?) make it possible to delete an account.
- [ ] (0:40?) when filling in settings for collaborators, show a spinner while waiting for info to download.
- [ ] (3:00?) latex: left/right split view.
- [ ] (4:00?) terminal: implement a scrollbar
- [ ] (2:00?) export sagews to sws
- [ ] (3:00?) idea: in project settings, specify a list of things to do when project is started; scripts to run, worksheets to evaluate, etc.
- [ ] (1:30?) way to configure displayhook output modes; e.g., svg versus png, threejs versus tachyon, etc.
- [ ] doc: how to X (make lots of specific todo's)
- [ ] (1:30?) make page like http://codemirror.net/demo/theme.html, but showing a file and a worksheet.
- [ ] (1:30?) change cursor so it is configurable to be transparent or a vertical bar -- configurable (requested by Rob Beezer) - https://mail.google.com/mail/u/0/?shva=1#search/sage-cloud/13fcf5dc2f951a26
- [ ] (2:30?) create a "snapshot" interact control based on Vivek and Jen's work.
- [ ] (2:30?) custom environment variables in project settings, including `SAGE_PATH` (with explanation) -- https://mail.google.com/mail/u/0/?shva=1#inbox/13fa0462bcaa7768
- [ ] (2:00?) transfer ownership: transfer this project to another user
- [ ] (2:00?) ui: make it possible for user to easily select a sage version for a project (from those available).
- [ ] (1:00?) start installing a bunch of optional R packages into sage -- https://mail.google.com/mail/u/0/?shva=1#sent/13ffd46fe8b33077
- [ ] (1:30?) easily toggle between split view horizontal and split view vertical (side by side); this would actually just be som easy css/html, I think....
- [ ] (3:00?) snap: search through past snapshots: by filename
- [ ] (3:00?) snap: search through past snapshots: by file content (no clue how to do that efficiently... but could just use grep + fuse + timeout + limit by user)
- [ ] (1:00?) feature: save terminal history to file.
- [ ] (1:30?) feature: hit tab anywhere when using a function to get the signature as a tooltip
- [ ] (1:30?) feature: tab completion when using a function could also complete on the keywords -- https://mail.google.com/mail/u/0/#inbox/13ec474c229055d9
- [ ] (1:30?) implement `pretty_print` -- see https://mail.google.com/mail/u/0/?shva=1#inbox/13e454cb56930ef0
- [ ] (1:00?) sagews: implement timer when evaluating code (?), but don't use jquery countdown, since it wastes resources at all times.
- [ ] (1:00?) sagews: modify search command to indicate result in output more sensibly (right now cursor gets big next to output)
- [ ] (1:30?) Modify the editor find command to have the option of doing a "fuzzy search" using the diff-patch-match library?!
- [ ] (1:00?) interact.coffee: refactor the big switch statement in `interact_control` to be extensible, so can easily add something to a map and get a new control.
- [ ] (4:00?) tern and tern coffeescript (?) -- make IDE much more serious! http://ternjs.net/


# Major new features

- [ ] (3:00?) make a table that logs events to a project and who does them (e.g., open file, save file, open project) -- and provide a new tab to view them.
- [ ] (3:00?) community tab: "explore" other projects.
- [ ] (6:00?) wiki view -- I was just browsing again through the the wiki system gollum used for the github wiki. This is basically what I am looking for - an extra folder myproject / wiki containing the wiki in human readable and editable files and folders, with default cloud view being rendered through gollum (using various rendering systems like rst or markdown). Github seems to not support mathjax anymore, but a switch to turn on mathjax on pages (or, if this is too much, mathjax being turned on by default) would be necessary in order to make math collaboration possible. Also, links to files and embedded pics from myproject / otherfolder would be good to have. Finally, making the wiki publicly visible (even if the project is still private) would be nice as well.  See https://mail.google.com/mail/u/0/?shva=1#inbox/13f9e7a22fbe59ec
- [ ] (3:00?) LXC per-project (which will imply quotas)
- [ ] (3:00?) idea -- bake in chunking messages over sockjs so we can send huge messages without reset and without stopping other messages; thus can edit large files.


# Server Bugs

- [ ] (2:00?) in hub (around `mesg_codemirror_get_session`) should we be much more careful adding client to sync'd session -- have the client send back confirmation.
- [ ] (2:00?) snap/hub: code to un-deploy projects that have been inactive for a while.
- [ ] (2:00?) Major bug/issue -- I just noticed that the ip address of clients appears to be on the VPN!  NOt their true external ip addresses.  This means my anti-account-creation, etc., measures are going to apply to everybody at once, rather than just a given external IP.  HMM.  This is tricky.  Of course, the impact is to restrict users much more severly.
- [ ] (1:00?) am I writing cassandra blobs as string constants? -- something about that in docs "Cassandra blobs as string constants"?
- [ ] (1:00?) when sending an email to reset account; if there is no account with that email, send that fact in the email *not* as an error back to the client, since otherwise we give away that the email is attached to an account.


# Server Features

- [ ] (2:00?) make caching of newly created blank projects something that is stored in the database, not the hub.

- [ ] (2:00?) compute: change compute nodes so they have a UUID that is indexed and regularly updated in DB, for project accounts... much like with snap servers; something running as part of hub (or some other new service, e.g., in admin.py?) would have to do this, since the project servers themselves are firewalled.  E.g., monitor connects to each possible compute server, runs a script (JSON output), then enters result in database.  This would include info about load, disk usage, etc., and be made available in the /stats url.  blah

- [ ] (2:00?) snap: write code to automatically sync out active repo every so often (?), and also when making a new active repo (by filling in database stuff)
- [ ] (2:00?) handle long url into a snapshot (or other), i.e.,
             https://cloud.sagemath.com/projects/project_uuid/.snapshot/timestamp/path/into/project
      when user (who must be logged in) visits this URL, they will open that project and the
      given file in the project, assuming they have appropriate permission to do so.
- [ ] (1:30?) change bup ls to use fuse to get full metainfo... or (better) make bup ls get the metainfo directly.
        time mkdir fuse; BUP_DIR=. bup fuse fuse; ls -lh fuse/master/latest/; fusermount -u fuse; rmdir fuse
- [ ] (2:30?) make the split view of worksheets work; the debugging aspect is no longer needed, really.


# Operations

- [ ] (3:00?) support cassandra authentication in addition to use firewall: http://image.slidesharecdn.com/cassandrasummit2013keynote-130613151129-phpapp01/95/slide-18-638.jpg?1371154320

---
[x] finish port forwarding:
--->    - [ ] test storm port forwarding:
- http forwarding works
- websockets does not work!
    why?
      x - test direct connect via vpn to make sure ipython install is serving correctly.
      x - test connect to hub via vpn to make sure problem isn't haproxy related: impossible with cookie thing
      - check logs
      - check node and http-proxy versions:  OOPS

salvus@storm-web1:~/salvus/salvus$ node --version
v0.10.2

    ... SO, fix the node version.

    - [x] test that firewalling works from outside -- nope; doesn't get started by admin.

    - [x] figure out exactly what firewall stuff we want for compute vm's, then figure out how to make those rules get automatically set.

WHAT we want:

    storm.compute_firewall('10.2.1.4', 'start')

    - [x] figure out how to block local host access:
         the internet says: " loopback interface doesn't get filtered by ufw. If you intend to block loopback traffic, you can add an iptables rule for that. "

- [x] use pkill instead of killall!!!!!!!



- [x] mathjax load issue -- "Failed to retrieve MathJax from ... " -- installing something "from IPython.external import mathjax; mathjax.install_mathjax()" into the ipython in sage fixes this.
       -    start ipython and type -- WAIT, this doesn't work because it is user-specific?
                   from IPython.external import mathjax; mathjax.install_mathjax()
       - we need to figure out the right way to start ipython that points at our nginx install of ipython.

This works:

        P=9100
        ipython notebook --no-browser --NotebookApp.mathjax_url=/mathjax/MathJax.js  --NotebookApp.base_project_url=/70a37ef3-4c3f-4bda-a81b-34b894c89701/port/$P/ --NotebookApp.base_kernel_url=/70a37ef3-4c3f-4bda-a81b-34b894c89701/port/$P/ --ip=10.2.1.4 --port=$P


- [x] the regexp matching in haproxy isn't working right.  I'm now wondering whether using regexp is a bad idea, since
      all the docs say it is slow, and this is a speed-critical path (and complicated url).  Hmm.

Given that uuid urls are not human writable or for humans, I should just put back in a prefix. This will be super
fast and work well.  OK, do it. OR?

https://cloud.sagemath.com/proxy/project-uuid/port/

Wow, Ipython-1.0.0 silently and bizarely transforms what should be this (when initializing a kernel)

 http://10.2.1.4:9000/70a37ef3-4c3f-4bda-a81b-34b894c89701/port/9000/kernels?notebook=671850a9-bfe3-497e-af5b-ff9d050d6a74

into this:

 http://10.2.1.4:9000/70a37ef3-4c3f-4bda-2a81b-34b894c89701/port/9000/kernels?notebook=671850a9-bfe3-497e-af5b-ff9d050d6a74

There's a mysterious 2 inserted before "2a81b".  This doesn't happen on port 8888.

Never, mind, it was all perfect to start with, and I put a stupid frickin' typo in.



- [ ] what exactly should I implement?

Design 1:
   a well in the Settings labeled "Ipython".
   If Ipython not running, it just has a button to start it.
   If Ipython is running it shows (rather small) the dashboard.
   Everything works exactly as normal.

Design 2:
   I modify the "ipython notebook" command so that it just works.

Design 3:
   * Make it so clicking an ipynb opens it like any other doc; each opened ipynb files has its own server
   * Luckily to open foo.ipynb, we can just do
        https://128.95.242.135:8443/70a37ef3-4c3f-4bda-a81b-34b894c89701/port/9100/foo.ipynb
     but subdirectories are not allowed.
   *

   * Add a new button "IPython worksheet" that makes a .ipynb file.


    IPython's design is just not up to snuff, with opening two copies of a file not protecting the user at all
    from loosing work.  It's horrible.  This is just not very good.  It's disturbing.  It cannot be promoted
    to first class for cloud.sagemath, since it's just not up to my standards in its total lack of sync.
    Sigh.

Design 4:

   * A new type of file that is an ipython notebook *server*:   foo.ipynbs

   * Embeds as an iframe the actual dashboard.

   * Has a GUI for configuring some of the parameters, restarting it, etc.:
        - e.g., path to ipynb files

   * Can be implemented purely client side.

   * Stores its config in the file.

   * New dropdown button:  "Server..." --> Ipython  (and can later have sage cell, sage, wiki's, etc.)

   * Just make a new editor type, that has the server conf as a synchronized string (as usual).

   * Have an on/off switch.

   * Have warning about the sorry state of IPython notebook sync.

   * Opening random ipynb files could just open the server file in the same directory if it exists (or create it),
     then call function on editor to open the actual file (which will appear in a new browser tab or iframe).


In Wakari they have evidently added a `notebook_relative` (?), which isn't in ipython-1.0.0

    <iframe id="" class="notebookiframe" src="https://prod-vz-10.wakari.io:9014/auto_login/acd84627972f91a0838e512f32e09c9823782ec0?next=/notebook_relative/scripts/examples/01_notebook_introduction.ipynb">
    </iframe>

        https://128.95.242.135:8443/70a37ef3-4c3f-4bda-a81b-34b894c89701/port/9100/notebook_relative/x/Untitled1.ipynb


Implementation:

Question: should I implement this `notebook_relative` thing like Wakari does?  Or, should I run a bunch of notebook servers?
If I do, why should i have more than one notebook server?
If there is only one notebook server, why have this whole .ipynb-server file...?

Thoughts:

   - can have different configurations of the server at the same time
   - logical place to put stuff, which is easy to ignore if you don't use it.
   - perhaps too motivated by having

----


Features, in order of importance:

    * click on ipynb file and have it work
    * easily switch into sage mode with sage preparser: %load_ext sage.misc.sage_extension
    * locking for safety; eventually realtime sync
    * chat (as usual)
    * get a terminal on the same ipython session:
         ipython console --existing c07b2a67-7974-470d-9553-933233fb906d
       (temporarily could just give a line to copy paste to a terminal)



 echo "%load_ext sage.misc.sage_extension" | ipython console --existing c07b2a67-7974-470d-9553-933233fb906d

 BETTER -- in startup command, do this:


     --ext=sage.misc.sage_extension


Immediate goal:

- [ ] write a script called `ipython_notebook` that sets the options needed for cloud, runs notebook server
      and fixes displayed urls in the output to be what user should visit.   This is for power users, but
      will help.  This will also be enough so that I can make a new release with this.
      Script will:

  - test that ipython is version >= 1.0.0, or give error and tell user that the ipython in path must be version >= 1.0.0
  - construct command line with my defaults
  - add on user's defaults



This basically works:

       sage -ipython notebook --ext=sage.misc.sage_extension --pylab=inline --matplotlib=inline --no-browser --NotebookApp.mathjax_url=/mathjax/MathJax.js  --NotebookApp.base_project_url=/36803084-2f38-498f-94be-75b808e1c2e1/port/9793/ --NotebookApp.base_kernel_url=/36803084-2f38-498f-94be-75b808e1c2e1/port/9793/ --ip=localhost --port=9793 2>&1 |./t.py


Steps to do this:

    [x] - modify localhub/globalhub so somehow the localhub knows the projectid.

     - write script; it will choose a random port





---


Another plan:

    - [ ] project settings configures default options for ipython servers (e.g., sage mode), and allow for arbitrary extra options to get passed in.

    - [ ] clicking an ipynb file opens its own server

    - [ ] disable the dashboard link

    - [ ] buttons similar to for sage worksheet


---

- [ ] finish ipython worksheets:

  x - ipython-notebook; needs to check ipython version

  x - creation of new files using a template (in project.coffee):
          - use for latex
          - *need* for ipynb files

  x - use existing session if there is one for that directory, and it is working -- this can just be a modification to the ipython-notebook script...

  x- server giving 404 error in some cases: suggests I need to use the uuid instead of filename, since that seems to always work:
       reading ipython source code shows json url for notebook listing is trivial to get!
             url = this.baseProjectUrl() + 'notebooks';

  x- info: provide terminal command to connect to session

  x- links into nbviewer such as http://nbviewer.ipython.org/urls/raw.github.com/jrjohansson/scientific-python-lectures/master/Lecture-4-Matplotlib.ipynb should just work

   x - button to explain how to open a terminal on an ipython kernel session.

   x - disable or remap buttons in ipython ui that don't make sense

   x - change UI info box to say that we've enhanced IPython to support realtime sync, continuous saving, etc.
     If you want to use traditional ipython, type "ipython-notebook xxx" in the terminal and don't use this.

   x- loading/saving py files

   x- proper live merge on sync -- or just set the live before applying patches!

   x - when loading page, don't show old version, then new version: instead completely control our own load, if possible.
      this should solve: issue with sync and opening things that take a long time, e.g.,  Lecture-4-Matplotlib.ipynb   -- should be fixed by properly waiting, etc.

   x - make sure cursor and scroll position don't massively *jump* on sync; actually keeping stuff right though will require implementing my own fromJSON, which is serious.

   x - behaves badly on reconnect, of course.

   x - still can go haywire and does *NOT* fix self when json structure gets corrupted...

   - optimize applying/making patches -- current approach very painful on large docs...
       - all time is on fromJSON, so let's optimize as follows:
           1. identify which cells need to change by comparing obj's before and after applying the patch.
           2. only fromJSON them.
           3. improve 1 by adding some other ops: insert/delete/permute

Idea to make sync faster and more robust, maybe:

   main file in standard format --> foo.ipynb

   sync doc --> .foo.ipynb.syncdoc
      - this is 100% what is used for the sync stuff and uses own format
      - created if doesn't exist; updated on open if foo.ipynb is newer (so edited some other way)
      - on filesystem save, save both .foo.ipynb.syncdoc, and let ipython save foo.ipynb.

   format:

      - line 0 is meta information in JSON
      - one line with the JSON of each cell for reset of file

   - then any corruption to the json file is local and hence trivial to recover from.
   - determining which cells changed is straightforward
   - to apply patch compute a "distinct unicode hash" of before and after, then use the the diff/patch library on that string to figure out what edits to make, unwind.

   This will work and be very efficient, almost optimal.
   The drawback is that editing the .ipynb file some other way won't get automatically merged in.  But that is reasonable.

Steps to implement this:

   x - write function: `to_doc` that converts an ipython notebook to the above format.
   x - write function: `from_doc` that makes an ipython notebook from the above format; delete bad jsoncells.....
   x - change syncdoc to use .foo.ipynb.syncdoc instead (and create if not known)
   x - test sync working
   x- optimize `from_doc` to use diff/patch approach to be more efficient and not delete bad json cells.

   x - the final fastsync challenge:

       1. convert the lists of cell json strings into a single unique unicode string sequence
       2. use the google-diff library to compute a patch to transform one to the other.
       3. implement code to apply that transformation.
   x - implement close for ipython worksheets -- they don't close right now and sync keeps going after close.

--->   - open .ipynb file instead, if it is *newer*;
      ok, this doesn't really make sense because the syncdoc *file* on the filesystem is never
      newer than the .ipynb file, since the .ipynb file is always saved at the same time.
      If the in-memory rep of the doc is newer than the ipynb on disk, then we want the
      in-memory one; otherwise we want the disk one.
      Solutions:

        syncdoc timestamp:

         - add codemirror_lastmod message that asks the local_hub the last time
           a document was modified (and returns file timestamp if not currently opened).
         - then just check if *that* is > disk version and in that case use sync version.
           Otherwise, use disk version.

        timestamp in the file itself:
         - patching could corrupt.
         - timezone (or just bad clock!) of client would break

        last sync time of file could be stored in cassandra:
         - create a new table that records who is changing a file and when.
         - this could be incredibly useful.
         - main worry would be that it could be a lot of traffic -- but we could change resolution.
         - also it's not at the source, so would be less accurate.
         - this is info we definitely want to store somewhere, but centralizing it is probably not a good idea.

           that said, knowing who is changing what when is very useful.  the table would be something like:
            project_id, path, account_id
           maybe this goes in the chat log... not sure.  seems database-ish though

   x- show current selected cell of other users when active

   x - ipython worksheets in responsive mode -- need to change position code.

   x- implement the codemirror_last_mod message, and might as well store *who* did it too, and display that, and display that, and display that.


---


   - [x] new release
         x -  fix ipython notebook "reload button".
         x- ipython notebook editor: since port can change or server can die, but ui doesn't help with this (since client so "dumb"), we need to add monitoring -- and when the backend dies, things get NASTY, so:
             1. if kernel is broken, don't sync until fixed.
             2. If the server dies for >= n seconds, have a dialog pop up to restart.

         - update base vm with salvus repo
         - release notes

----

Dear Sagemath Cloud Users,

I've updated https://cloud.sagemath.com:

   - All virtual machines rebooted.

   - New support for IPython notebooks -- just click +New, then the "IPython" button,
     or open any ipynb file.  This was a huge amount of work, because I implemented
     realtime synchronization for IPython notebooks, so you can have multiple people
     edit a notebook at once, and have multiple browsers/browsers tabs viewing
     the same notebook (which can be useful when editing).

   - Upgraded Octave from 3.2 to 3.6.

   - Updated the LaTeX distribution from 2009 to 2012.

   - Improved the +New page -- now there is only one blank where you can put both URL's and filenames,
     and some URL schemes are treated intellegently (e.g., trac patches, ipython notebook viewer, github repo).

   - Use pkill instead of kill, so "Restart Project Server" will be much more robust.

   - Made various buttons much bigger in mobile mode.

Now that the IPython notebooks and latex features are implemented, I'm going to spend
most of the next week (or more) focused entirely on bug fixing, deploying more hardware,
a blog post explaining how the IPython sync works, and hopefully some screencasts.
I'm aware of a huge number of bugs all over that need to be fixed, thanks to reports
from many people.  However, if you have a bug that particularly annoys you, let me know.

Also, I expect that there are probably many bugs in the IPython notebook integration; before
a week ago I had never significantly used (or worked on the source code) of the IPython notebook,
and may have messed up some things.   The latex upgrade could also cause trouble. Let me know!

-- William

---




- [x] firefox terminal copy / paste (with mouse right click)

- [x] firefox copy with control-c

- [x] firefox paste with control-v

- [x] make control-v paste in terminal.

- [x] don't leak click handlers for terminals anymore; cleanup on close.

- [x] update the help page with modern latex instructions.

- [x] terminal [...] burst mode is still LAME.

- [x] terminal hangs -- make impossible:

plan -- make it so hub kills the terminal connection after 20 seconds (say) for no reason.
     -- watch logs
     -- make client detect and fix.

- [x] terminal: doesn't seem to be resizing correctly on *first* open; hitting refresh button once fixes it.

----

- [x] blog post on ipython sync... MONDAY

- [x] improve some packages and email list about this:

    - apt-get install these and add to build.py:

          libpango1.0-dev xorg-dev gdb valgrind doxygen

    - rebuild r in Sage:

          cd /usr/local/sage/current; umask 022; ./sage -f r

   ssh -t "sudo apt-get install libpango1.0-dev xorg-dev gdb valgrind doxygen && cd /usr/local/sage/current && umask 022 && ./sage -f r" 10.1.2.4
   ssh -t "sudo apt-get install libpango1.0-dev xorg-dev gdb valgrind doxygen && cd /usr/local/sage/current && umask 022 && ./sage -f r" 10.1.3.4

- [x] Make it so R plot "just works"
      -- see https://mail.google.com/mail/u/0/?shva=1#search/r+sage-cloud/140c9b84390ca622
      and https://mail.google.com/mail/u/0/?shva=1#search/r+sage/1410846224b9999c

This works after rebuilding R:

︠f0ae70bd-325f-4c7e-aed0-610a54b709d1︠
%r
cars <- c(1, 3, 6, 4, 9)
︡193f24c8-c38c-4b07-8c6e-26acca32c225︡{"stdout":"\n"}︡
︠93d68a89-c03b-4375-bc8a-2e2a44b3acf4︠
%r
plot(cars)
︡c7e9394b-6fdf-4992-804d-45f802f835cd︡{"stdout":"\n"}︡
︠20b47fb4-bddc-4d4e-82e6-0126fe05bb9e︠
r.dev_off(); salvus.file('Rplot003.png')

- [x] terminal: paste is sometimes pasting way too much.




---
- [x] (0:45?) (1:18) upgrade to newest codemirror

       new file:   mode/index.html
#       new file:   mode/nginx/index.html
#       new file:   mode/nginx/nginx.js
#       new file:   theme/paraiso-dark.css
#       new file:   theme/paraiso-light.css
#       new file:   theme/the-matrix.css

  - [x] with proper fortran support: https://github.com/mgaitan/CodeMirror/tree/be73b866e7381da6336b258f4aa75fb455623338/mode/fortran

- [x] (0:20?) (0:16) sage --> "sage worksheet"
      "Sage" means "Sage worksheet", "IPython" means "IPython notebook" ;
      add tooltips!

- [x] (0:10?) (0:02) "Salvus sent a reset...password" -- don't say "salvus".


- [x] terminal concern: what if the channel unicode character is sent over the channel? hmmm...  In tests, it works fine.  䡈 Neato.

- [x] terminal: needs scrollbar https://github.com/chjj/tty.js/issues/72



- [x] (2:00?) terminal: display/echoing of control codes on reconnect
          (also -- kind of same -- history is just appended again on reconnect -- NOT good.)

plan:
   - a message to connect to a terminal:

        debug: client --> hub (client=4be2c7fd-4d4c-4116-a796-30291650586c): {"event":"connect_to_session","type":"console","project_id":"09f6d5da-9b32-4384-88d7-87db87d46bdb","session_uuid":"7b18f443-04ce-40ac-b77b-cc997895512e","params":{"command":"bash","rows":24,"cols":80,"path":""},"id":"82e2b02b-52de-4734-8a74-4a118187d96b"}
        debug: hub --> client (client=4be2c7fd-4d4c-4116-a796-30291650586c): {"event":"session_connected","session_uuid":"7b18f443-04ce-40ac-b77b-cc997895512e","data_channel":"䡈","id":"82e2b02b-52de-4734-8a74-4a118187d96b"}


   - a response with info, and also the history
   - set history using that

However, it might be very natural to just have the session history be in a syncdoc string -- the filename.term.
E.g,. the first line could be a uuid (maybe followed by other meta info)
      then all future lines are the history

- [x] terminal -- strip trailing whitespace on copy?

- [ ] new release:

       [x] update salvus repo

       [x] change in /usr/local/bin/skel/.bashrc
           HISTCONTROL=ignoredups

       [x] ggplot2 --
           umask 022; R
           install.packages(c("ggplot2", "stringr", "plyr", "reshape2", "zoo", "car", "mvtnorm", "e1071", "Rcpp", "lattice",  "KernSmooth", "Matrix", "cluster", "codetools", "mgcv", "rpart", "survival"), repos='http://cran.us.r-project.org')

            How to automate:

                0 jan@snapperkob:~/src/r-install-packages-0.1ubuntu5$cat r-install-packages.R
                #! /usr/bin/Rscript --vanilla
                options(repos="http://cran.ru.ac.za/")
                res <- try(install.packages(c("deSolve", "fracdiff", "plyr", "reshape2", "ggplot2", "PBSddesolve"), dependencies=TRUE))

                if(inherits(res, "try-error")) q(status=1) else q()
                0 jan@snapperkob:~/src/r-install-packages-0.1ubuntu5$


Dear Sagemath Cloud Users,

There's a new version with the following changes.

   - Implemented a scrollbar for the terminal.

   - Fixed the control codes appearing on connect and reconnect in the terminal, and also
     the size being wrong.  (In fact, the terminal was sending capability codes back in
     response to requests when rendering the history.)

   - Made it so that when you copy text from the terminal there is no trailing whitespace.

   - Made the color theme names for the terminal match the editor names.  Also, as a
     bonus, I added two new Raven themes from: https://github.com/baskerville/xresources-color-schemes
     (If anybody wants to add more themes, email me.)

   - Terminal: added a standard textarea version of the terminal contents, accessible via the
     clipboard button in the terminal -- this lets you copy the entire history of your session
     (at least the amount that is stored).

   - Upgrade codemirror from version 3.15 to version 3.16.
       - New editing modes:
         .conf -- nginx conf files
         .f,f90,f95 -- fortran mode
       - New color themes:
          paraiso-dark, paraiso-light, the-matrix
       - There were some scrolling bugs with large documents in 3.15 that seem fixed now.

   - Change .bashrc in new projects to have HISTCONTROL=ignoredups, so your history includes lines
     that start with whitespace.

Enjoy and tell your friends,

 -- William

----

- [x] spinner when loading project log

- [x] scalability: increase number of hubs that can run on one machine.

- [x] next release:

     [x] ensure restarted projects get it by putting a copy of skel/.sagemathcloud/node_modules in
            cd salvus/salvus/local_hub_template
         then doing
            npm install express

     [x] ensure new accounts get it via:
            sudo cp -arv /home/salvus/salvus/salvus/local_hub_template/node_modules/express /usr/local/bin/skel/.sagemathcloud/node_modules/

     [x] test: old project works with express
         test: new project works with express
         test: ipython still works.

- [x] implement static file serving url, but don't use for anything yet (?):
    x - add support to `local_hub` so it starts a static http server on a random port (save port)
    x - have it record the port in that status file
    x - update haproxy to map /project-id/raw/ to a hub
    x - add a new url handler in global hub for /raw/
    x - when request to raw comes in, handle auth as in /port/
    x - when auth is ok, create local hub object and use that to determine port
    x - ensure proper caching and timeouts.
    x - make static http server not listen on localhost for security reasons -- only listen on tun interface
    x - get rid of remember me as an option, since otherwise there is no way to auth for file download.
    x - make logout actually remove/invalidate remember me
    - raw file browser link in settings.
    x - make file download button in ui use this instead
- [x] next release:
   - make sure to restart hub, due to new password reset email format

Dear Sagemath Cloud Users,

I've updated the site with the following changes.

  - Fixed some bugs with password reset, especially with Safari (reported by Nathan Carter and others)

  - PARI/GP syntax highlighting mode -- this should work automatically when you edit .gp scripts,
    and when you make a %gp cell in a worksheet  (inspired by a Stack Overflow question from Kate Stange).
    (requires browser refresh)

  - (requires project server restart) New worksheet function:  salvus.link!  You can now do

        salvus.link("path/to/directory")   or  salvus.link("path/to/foo.bar")

    and you'll get a link to that thing.  There are some options, including customizing
    the CSS classes (to get a button) -- type salvus.link? [return] for help.
    This is an *incredibly* useful new feature, since you can make a file such as index.sagews
    in the top of your project, and put shortcuts in there to your favorite files and directories,
    to make them easy to open later.

  - (requires project server restart) New plotting functionality.  You can now make it so when
    you click on a point in a plot, then a Python function is called.   Here's a complete interact
    that illustrates using this new feature:

        @interact
        def f0(fun=x*sin(x), mousemove='', click=''):
            g = plot(fun, (0,5))
            def h(p):
                f0.mousemove = p
            def c(p):
                print "click"
                f0.click = p
            show(g, events={'click':c, 'mousemove':h}, gridlines=True)

    Basically, I've extended show with an events option, which a dictionary with keys
    the names of Javascript events, and values functions that take input a point (x,y).
    It's a very simple API, but also easy to use/remember.  I think it should also get
    implemented in the sage cell server.

    NOTE: I have only implemented two events so far 'click' and 'mousemove' -- no other
    ones are implemented!  Also, you can only use this with Sage 2d plots right now,
    not matplotlib plots, though that will be very easy to add.


 -- William



- [x] fix password reset issues:

    - [x] Clicking anywhere outside the password reset modal makes it vanish, which is a bad (de)sign
    - [x] password reset broken when using mail with "Apple Mail.app Version 6.5 (1508)." and auto-open in chrome (found by Nathan Carter).


 - [x] easy index.sagews style functionality?



- [x] polish interact clicking.

- [x] password reset bug: https://mail.google.com/mail/u/0/?shva=1#inbox/141372b2c139b86d

- [x] define __SAGEWS__

- [x] file/folder icons -- https://mail.google.com/mail/u/0/?shva=1#inbox/140b3393cd9b3f68

- [x] custom error page: https://mail.google.com/mail/u/0/?shva=1#inbox/14137ba797afb5df

- [x] mobile close project - button instead of x

- [x] fix doc tabs re-appearing on sync issue:
         - https://mail.google.com/mail/u/0/?shva=1#search/from%3Aharald+reappear/14117ffaf253ce06

- [x] multiple users restarting a project at once --> BAD:  https://mail.google.com/mail/u/0/?shva=1#inbox/14138a0e567374b1

        What's happening is that many different users -- connected to many
        different hubs -- where many is >= 2 (at least), all tried to restart
        the project server at the same time.  Step 1 of restarting the project
        server is to kill all processes on the project server.

        In this case, the net result is a loop, where every time one person's
        hub tries to restart the project server, somebody else's kills that
        restart... so that first hub tried again, ad infinitum.

        I just restarted all the hub servers, so maybe this will stop and your
        project will restart fine.

        For some reason I hadn't yet implemented something to deal with the
        above sort of issue. The fix is straightforward, which is to put an
        expiring lock file in the project when restarting it -- I do exactly
        that with snapshots, and that works very well in practice.

        I'll implement this very soon, since obviously it is a major issue....
        when many people use the same project.

PLAN:

   - read lock code I wrote for snap
   - .sagemathcloud/lock that contains the hub ip address; etc. -- timeout after 30 seconds?

- [x] for graphics need to execute salvus.execute_javascript, salvus.execute_coffeescript, and once=True for messages.

     I've got the execute_*, but its *insecure* as of now, since a localhub could put a wrong session_id in,
     and broadcast an eval message to clients... of course, the localhub would have to know the session_id, which
     is actually a secret and ephemeral.  So this isn't a practical problem.


- **** **** 2013-09-24 at 1:32pm!
  in local hub, fail gracefully when info.json missing:
  start_raw_server = (cb) ->
    # It's fine to move these lines to the outer scope... when they are needed there.
    info = fs.readFileSync('.sagemathcloud/info.json')

- also the local hub restart lock needs to be longer (?)


- [x] next release
   - Add this to rc.local:
          ip link add link eth0 address f0:de:f1:b0:66:8e eth0.1 type macvlan
   - install "and":  apt-get install and
   - do this to base vm:

#/etc/cron.d/oom_disable
*/1 * * * * root pgrep -f "/usr/sbin/sshd" | while read PID; do echo -17 > /proc/$PID/oom_score_adj; done


Dear Sagemath cloud users,

I've released a new version:

  - Restarted the project servers

  - Significant updates and *efficiency improvements* to 3d graphics

  - Updated to CodeMirror 3.18, which adds support for .m files (=octave/matlab),
    .toml files (=config file format), and .dtd (=some XML format), and fixes bugs.

  - Changing the editor theme now takes effect immediately, so you do not have
    to close/re-open each tab or explicitly save.  All


William


- [x] create a new clean wrapper object that one can send commands to from python to javascript world.

    In Python:

        t = threejs([3d scene])   # creates javascript object in output area and python class with
                        # saved uuid; the object is data on thing with given id=uuid.
        t.add(sphere())  # or any sage 3d graphics scene
        t.animate()

    Make it so all the Python scene manipluation functions can run
    sensibly with salvus.javascript(..., once=True)

     - [x] make this new wrapper the default and delete old code.
     - [x] add interesting new functionality
     - [x] only animate when mouse over graphics
     - [x] send scene via broadcast message (so doesn't make worksheet big).
     - [x] investigate what happens when out of view
     - [x] draw frame
     - [x] draw axes labels
     - [x] support text3d command
     - [x] wireframe=True option when adding plots
     - [x] particle instead of sphere geometry?: LATER -- can do a lot to move rendering to threejs.  But we don't *need* to yet.
     - [x] mesh on surface?
     - [x] fallback for rendering primitive objects... until have fast code for each.
            : LATER -- can do a lot to move rendering to threejs.  But we don't *need* to yet.
     - [x] make sure camera control rotates us around center of frame, not origin!
     - [x] fallback for rendering primitive objects... until have fast code for each.
     - [x] mesh on surface?
     - [x] fast points (via particles)
- [x] upgrade codemirror to 3.18:
     - [x] new support for .m files (=octave/matlab), .toml files (=config file format), and .dtd (=some XML format)
1
