@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
FINAL TOP PRIORITY THIS WEEK TODO LIST;
Tuesday   Mar 26    3pm - 11pm:    7
Wednesday Mar 27    5am - 11pm:   16  (not counting food/shower)
Thursday  Mar 28    5am - 11pm:   16
Friday    Mar 29    5am - 11pm:   16
Saturday  Mar 30    5am - 11pm:   16

Max possible hours: 71

Sunday -- get prepared for my teaching on monday

---------------------------------------

= UX =
(0:20?)  [x] (0:06) do not delete whitespace on line that contains the cursor (codemirror plugin)
(0:20?)  [x] (0:22) in project file listing search, make it so that the *other* hidden files are not clickable!
(0:45?)  [x] (0:14) cursor replication when sync starts -- might have fixed it -- NOT SURE!
(0:30?)  [x] (0:30) after entering a command in project command line, focus should *stay* on command line.
(1:00?)  [x] (1:55)  create a new file/directory;default filename for terminal and worksheet date/time iso format
(0:30?)  [x] (0:16) the alert message tab thing covers the connection settings.

(0:20?)  [x] (0:40) bug: sometimes clicking the x to close an open file (in file editor pills) just leaves it -- even though counter goes down; then it can't be closed; this is also why sometimes searching the list of open files doesn't work.;   ALSO did more work on new file page (which took most of the time)

(0:30?)  [x] (0:06) project: When changing project title, should auto change the entry in the tab at the top.
(0:30?)  [x] (0:08) editor - the undo buffer should *NOT* start with buffer empty, but with result of loading content!!!

(1:30?)  [x] (0:50) make it so project nav tabs hide when showing editor; make codemirror edit window "FULL SCREEN" always
         [x] (0:36) greatly improve style of top bar due to fullscreening
(0:45?)  [x] (1:30) make worksheet edit window "FULL SCREEN" always; still not so clean!

(0:45?)  [x] (1:43) make terminal edit window "FULL SCREEN" always -- and cleaned up some related things all over, especially proper resizing math.
(0:20?)  [x] (0:17) file selector -- putting slash at end in search should restrict to directories.
(0:20?)  [x] (0:08) create new file by typing a name that results in no hits in file search creates it... with a button to choose type (or cancel)
(1:00?)  [x] (0:59) editors need to have "show" called when window is resized; also, get rid of responsive top bar bullshit and do it right.
(0:30?)  [x] (0:59) idea -- what if we allow opening the same project in multiple tabs -- then get multiple views on same project.  Not good. Instead, usable implementation of files as tabs optionally to try out...
(1:00?)  [x] way to make a new folder
(1:00?)  [x] (1:00) way to rename file
(0:30?)  [x] (0:42) delete/download file icons should only appear on hover; also, added a link for importing files from the web (will use wget)
         [x] (1:10) refactoring and cleanup of file listing code.
(0:45?)  [x] (0:42) way to delete files; just moves to project_path/.trash, making that directory if necessary and printing a message
(0:30?)  [x] (0:30) close all recently opened files.
(1:00?)  [x] (1:13) import files form web using wget --- make it live; add a slider for how long it will try to download until giving up.
(0:30?)  [x] (0:15) way to browse trash can
(0:30?)  [x] (0:36) way to empty trash can
(1:30?)  [x] (0:59) way to move files into a folder by dragging them.
(0:30?)  [x] fix auto-resizing of input cells of worksheet
(0:30?)  [x] (0:40) show hidden files toggle (icon?) -- also fixed misc trash-can related bugs
         [x] (0:09) slight improvements to css of open files
(0:30?)  [x] (0:14) error message when file doesn't load should not be *in* codemirror
(0:30?)  [x] (0:18) need a "save all open files" button somewhere (in editor's list of open files page)
(0:45?)  [x] (0:16) bug -- worksheet tab completion is now broken (actually underneath) worksheets...; also fix vertical resizing as options for worksheet cells
(0:15?)  [x] (0:10) need to save worksheet on creation, so next load has a chance to work.

(0:45?)  [x] (1:06) make it so the little project tab bar is *always* visible, just below the main nav bar.  Will require care about fullscreen size for each.
(0:30?)  [x] (0:27) get rid of code that always switches to recent and vanishes editor on selecting tab -- just leave as is; add "open file/folder" button
(0:20?)  [x] (0:42) list of files in file browser for project needs to be scrollable and have fixed height.
(0:15?)  [x] (0:11) file rename -- should have to click twice to activate?

(0:10?)  [x] (0:15) bug: control-o in editor to get to recent is broken

With the following done, we will have 100% fixed the UI for now:

(0:30?)  [x] (0:45) do not actually open a tab in editor unless the user explicitly selects it.  Make this lazy.  this was we can leave recent as is.

(1:00?)  [x] (0:50) PLAN THIS: each open file *must* corr to a tab in the second line bar. Sorry.  Get rid of the path up there and put a big pull-ed right
             tabbar up.  Shrink to accom. arbitrary many.
(0:30?)  [x] (make project nav area full with

(0:10?)  [x] (0:15) move little upper right path

(0:30?)  [x] (0:30) stacked cursors issue -- local hub should only allow global hub once as a client for given file.
              doubled cursors issue is now fixed.

(1:30?) [x] (0:30)  when visiting a synchronized editing session after a long time (and sync broken), the first few
        characters typed get jumbled.   I'm not going to worry more about this, since it *only* happens if
        the local_hub goes down... and maybe then some loss is inevitable.  This is not something (like user's connection or global hub change)
        that will happen much.
(0:45?) [x] cursor doubling -- this is because the same hub connects twice to the same local_hub and broadcasts to itself.
                Solution: when connecting to local_hub, local_hub should discard all connections from that same hub.
                Could be determined by a self-reported uuid on startup of global hub.
(1:00?)  [x] (0:15) clean up the bar at the top of worksheets; make consistent with files...
         [x] Make background color of worksheets consistent... and easy to change later.
 (0:30?) [x] (0:30) when showing worksheet, need to call refresh on all cells in the worksheet


(0:30?)  [x] (1:05) range selection -- need to also preserve that on sync.  (harder than I thought!)

        [x] (0:22) make the trash can vastly more usable using move's amazing "backup" option; add file list refresh option.

(0:30?)  [x] (1:20) make it so the chat window appears again.
(0:45?) [x] re-enable (and test) automatic timeout of sync sessions in local_hub

 (0:45?)  [x] (0:37) bug in directory download -- need to name things sensibly; may require changes in hubs.


(0:30?) [x] (1:10) download a project, etc.


(1:00?) [ ] when a session has timed out, chat just doesn't work.
            typing once into the session and waiting... makes chat work.
(0:45?) [ ] worksheet sessions: killing them doesn't work; interrupting doesn't work.
(1:00?) [ ] worksheet sync: define code to diff two worksheets and make a patch
(1:00?) [ ] worksheet sync: define code to apply a patch to a worksheet
(1:30?) [ ] worksheet sync: integrate code for using these other diff/patch functions into client
(1:30?) [ ] worksheet sync: integrate code for using these other diff/patch functions into hub
(1:30?) [ ] worksheet sync: integrate code for using these other diff/patch functions into local hub
(0:45?) [ ] sync: global hub needs to also timeout inactive sync sessions.

=======================


(0:45?)  [ ] bug: worksheet -- default path is relative to home directory not project.
(1:00?)  [ ] worksheet: be able to print a worksheet (something involving HTML/CSS)

(0:10?)  [ ] make other standard tabs only icons; move search box to search page only
(0:30?)  [ ] move editor tab placement to project code and tabs -- each open file is in a project tab; code will need to be refactored.
(0:30?)  [ ] make it so tab widths are proportional to number of tabs, so at most one row, ever.

(1:00?)  [ ] (0:04 so far) file upload using http://www.dropzonejs.com/; need to accept POST
(0:45?)  [ ] split document editing (see two parts of doc at once): http://codemirror.net/doc/manual.html#linkedDoc

(0:30?)  [ ] codemirror editor settings: whether or not lines wrap in codemirror. (apply for both files and worksheets)
(0:20?)  [ ] codemirror editor settings: color scheme
(0:20?)  [ ] codemirror editor settings: auto delete trailing whitespace should be an option in global settings

(1:00?)  [ ] change filename extensions to ".sage-worksheet", ".sage-terminal", ".sage-cell", ".sage-quiz", ".sage-backup", ".sage-chat", etc.

(0:45?)  [ ] editor buttons: search/replace/undo/redo/autoindent/split
(0:30?)  [ ] if you start clicking around directories quickly, you can easily get to a nonexistent path due to time of gitls round trip.  So... when that happens display the last valid path; save last working path, and don't change path to a directory that doesn't exist (as determined by an error from git-ls)
(0:30?)  [ ] show quota info in project settings.
(1:00?)  [ ] make note cells be markdown with $'s for math.  Codemirror editor with syntax highlighting.
(0:45?)  [ ] interact plus moving cells bug: just add a data attribute to those cells so skipped
(0:45?)  [ ] cells: move (control-arrow) should move all cells with checkbox checked.  (and control-arrow doesn't work on os x, right?)
(1:00?)  [ ] attach: implement the attach command for (backwards) compatibility.
(1:00?)  [ ] option to completely delete a project, irrevocably.   (BIG RED SCARY SERIOUS -- type your name, etc.)
(1:00?)  [ ] bug -- when reconnecting to a TERMINAL session, it display a bunch of garbage codes.
(0:30?)  [ ] bug -- typing *while* first syncing moves editor display down one each character typed.
(0:45?)  [ ] bug -- resizing terminal results in codes getting sprayed on the screen
(0:45?)  [ ] bug -- delete directory containing a file being edited -- save *appears* to work, but doesn't.
(0:20?)  [ ] bug -- download file with bad URL/failure gives useless error
(0:30?)  [ ] in sign-up: explain that service it currently donation-supported.
(0:45?)  [ ] in settings: ask for money and give link to donate to Sage foundation.
               provide a checkbox that says "I have donated."  When they check it, it changes to a big thanks!
(0:45?)  [ ] file listing pagination

= Accounts =

Each account will have a list of unix users associated to it, starting with one.
These will be listed in the settings page.
A unix user = username@host... such that hub can ssh in.
Unix users can be shared with other users of SMC; if a user is shared, then both users of SMC have 100% access to everything.
Database table that lists all projects for a given user.

(1:00?)  [ ] When creating a new project, option to choose from a list of users if there is more than one user associated to an account.
(1:00?)  [ ] admin.py -- write Python code to login, then sudo and configure accounts on a machine for users,
               then record that this succeeded in the database.
          admin.provision('03salvus-users', k, max_disk=4096)
          # Makes it so the accounts of the form smc1, smc2, smc3,...,smck, exist, on that machine,
          # with /home/smc[n] built from a template, and ssh-keys access setup
          # Also they have the given disk quota.
          Here the machine name is as listed in the the hosts file.
(1:00?) [ ] hub -- when a user creates an account, assign them a unix user.
(0:45?) [ ] Clone a project (under settings).

= Browse =

(0:30?) [x] Add a new tab at the top called "Explore" that is to the left of "Your Projects"

(1:00?) [ ] Search page:    (similar function to https://github.com/explore)
               * search = on project name and description (I will have to build indexes at some point...)
               * place to show results

(0:45?) [ ] clicking on a project in result list opens it (as usual) in read/write mode, if you have write access to it.
(0:45?) [ ] write a "visitor" access project mode
(1:00?) [ ] In project browser, any location should have a url which can be used as a shortcut to get back there.
              https://cloud.sagemath.org/projects/project_id/path/in/filesystem
            Make a link to get this next to the file, and also in browser.  Kind of like with google maps.
(0:45?) [ ] Add code to hub so that if user requests such a url, they get that project opened in the given location.



= Deploy =
(0:30?)  [x] (0:14) apply security updates and reboot 01salvus (done) and 06salvus (done)
(1:00?)  [ ] MINIFY actual page js
(1:00?)  [ ] change any hard coded "salv.us" to cloud.sagemath.org
(0:30?)  [ ] make sure email reset works with cloud.sagemath.org
(1:00?)  [ ] build virtual machine that is up2date and has all necessary packages (including ghostview, etc.)
(0:30?)  [ ] define topology file for deployment
(0:30?)  [ ] get it running
(1:00?)  [ ] get ssl cert setup for cloud.sagemath.org