@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
FINAL TOP PRIORITY THIS WEEK TODO LIST;
Tuesday   Mar 26    3pm - 11pm:    7
Wednesday Mar 27    5am - 11pm:   16  (not counting food/shower)
Thursday  Mar 28    5am - 11pm:   16
Friday    Mar 29    5am - 11pm:   16
Saturday  Mar 30    5am - 11pm:   16

Max possible hours: 71

Sunday -- get prepared for my teaching on monday

---------------------------------------

= UX =
(0:20?)  [x] (0:06) do not delete whitespace on line that contains the cursor (codemirror plugin)
(0:20?)  [x] (0:22) in project file listing search, make it so that the *other* hidden files are not clickable!
(0:45?)  [x] (0:14) cursor replication when sync starts -- might have fixed it -- NOT SURE!
(0:30?)  [x] (0:30) after entering a command in project command line, focus should *stay* on command line.
(1:00?)  [x] (1:55)  create a new file/directory;default filename for terminal and worksheet date/time iso format
(0:30?)  [x] (0:16) the alert message tab thing covers the connection settings.

(0:20?)  [x] (0:40) bug: sometimes clicking the x to close an open file (in file editor pills) just leaves it -- even though counter goes down; then it can't be closed; this is also why sometimes searching the list of open files doesn't work.;   ALSO did more work on new file page (which took most of the time)

(0:30?)  [x] (0:06) project: When changing project title, should auto change the entry in the tab at the top.
(0:30?)  [x] (0:08) editor - the undo buffer should *NOT* start with buffer empty, but with result of loading content!!!

(1:30?)  [x] (0:50) make it so project nav tabs hide when showing editor; make codemirror edit window "FULL SCREEN" always
         [x] (0:36) greatly improve style of top bar due to fullscreening
(0:45?)  [x] (1:30) make worksheet edit window "FULL SCREEN" always; still not so clean!

(0:45?)  [x] (1:43) make terminal edit window "FULL SCREEN" always -- and cleaned up some related things all over, especially proper resizing math.
(0:20?)  [x] (0:17) file selector -- putting slash at end in search should restrict to directories.
(0:20?)  [x] (0:08) create new file by typing a name that results in no hits in file search creates it... with a button to choose type (or cancel)
(1:00?)  [x] (0:59) editors need to have "show" called when window is resized; also, get rid of responsive top bar bullshit and do it right.
(0:30?)  [x] (0:59) idea -- what if we allow opening the same project in multiple tabs -- then get multiple views on same project.  Not good. Instead, usable implementation of files as tabs optionally to try out...
(1:00?)  [x] way to make a new folder
(1:00?)  [x] (1:00) way to rename file
(0:30?)  [x] (0:42) delete/download file icons should only appear on hover; also, added a link for importing files from the web (will use wget)
         [x] (1:10) refactoring and cleanup of file listing code.
(0:45?)  [x] (0:42) way to delete files; just moves to project_path/.trash, making that directory if necessary and printing a message
(0:30?)  [x] (0:30) close all recently opened files.
(1:00?)  [x] (1:13) import files form web using wget --- make it live; add a slider for how long it will try to download until giving up.
(0:45?)  [ ] project rename/desc just like file rename
(0:30?)  [x] (0:15) way to browse trash can
(0:30?)  [ ] way to empty trash can
(1:30?)  [ ] way to move checked files into a folder (or ..) --> simply drag them.
(0:45?)  [ ] implement directory download -- need to name things sensibly; may require changes in hubs.
(0:45?)  [ ] when showing worksheet, need to call refresh (?) on all cells in the worksheet
(0:30?)  [ ] fix auto-resizing of input cells of worksheet
(1:00?)  [ ] clean up the button bar at the top of worksheets; make consistent with files...
(1:00?)  [ ] reconnecting to existing worksheet sessions isn't working making it impossible to open worksheets
(1:30?)  [ ] terminals should automatically restart if the backing session dies.  Keep history and cwd. make terminals robust.
(0:45?)  [ ] changing password should invalidate all cookies.
(0:45?)  [ ] error message when file doesn't load should not be *in* codemirror
(0:30?)  [ ] need a "save all open files" button somewhere (in editor's list of open files page); also same for "close all".
(0:45?)  [ ] tab completion is now broken (actually underneath) worksheets...
(0:45?)  [ ] when searching, automatically copy highlighted text into search box.
(1:00x)  [ ] split document editing (see two parts of doc at once)
(0:45?)  [ ] editor buttons: search/replace/undo/redo/autoindent/
(0:45?)  [ ] worksheet bug -- default path is relative to home directory not project.
(0:45?)  [ ] show hidden files checkbox
(0:30?)  [ ] if you start clicking around directories quickly, you can easily get to a nonexistent path due to time of gitls round trip.  So... when that happens display the last valid path; save last working path, and don't change path to a directory that doesn't exist (as determined by an error from git-ls)
(0:30?)  [ ] auto delete trailing whitespace should be an option in global settings
(0:30?)  [ ] show quota info in project settings.
(1:00?)  [ ] change filename extensions: ".sage-worksheet", ".sage-terminal", ".sage-cell", ".sage-quiz", ".sage-backup", ".sage-chat", etc.
(1:30?)  [ ] make note cells be markdown with $'s for math.  Codemirror editor with syntax highlighting.
(1:30?)  [ ] file upload
(0:30?)  [ ] codemirror editor settings: whether or not lines wrap in codemirror. (apply for both files and worksheets)
(1:00?)  [ ] codemirror editor settings: color scheme
(1:00?)  [ ] interact plus moving cells bug: just add a data attribute to those cells so skipped
(1:00?)  [ ] worksheet: be able to print a worksheet (something involving HTML/CSS)
(2:00x)  [ ] write some basic user-oriented documentation (?)
(1:00?)  [ ] cells: move (control-arrow) should move all cells with checkbox checked.  (and control-arrow doesn't work on os x, right?)
(1:00?)  [ ] informal terms of usage -- put up something very short but useful and serious.
(0:45?)  [ ] in sign-up: explain that service it currently donation-supported.
(1:00?)  [ ] in settings: ask for money and give link to donate to Sage foundation.
               provide a checkbox that says "I have donated."  When they check it, it changes to a big thanks!
(0:45?)  [ ] Do not allow creation of private projects unless users claims to have donated.
(1:00?)  [ ] attach: implement the attach command for (backwards) compatibility.
(1:00?)  [ ] *need* to easily be able to resize the height of the output and have this saved!!!
(1:00?)  [ ] option to completely delete a project, irrevocably.   (BIG RED SCARY SERIOUS -- type your name, etc.)
(0:30?)  [ ] range selection -- need to also preserve that on update.
(1:00?)  [ ] when reconnecting to a TERMINAL session, don't display a bunch of garbage codes.
(0:45?)  [ ] it might be nice if open file thing had -- in upper right -- "scratch: [ws] [trm]" icons...?
(0:30?)  [ ] close brackets -- would make editor and notebook nicer, maybe -- http://codemirror.net/addon/edit/closebrackets.js
(0:30?)  [ ] typing *while* first syncing moves editor display down one each character typed.
(0:45?)  [ ] bug -- resizing terminal results in codes getting sprayed on the screen
(0:45?)  [ ] Editor bookmarks?.  Ctrl-B to toggle then, Ctrl-I to move to next?
(0:45?)  [ ] bug -- delete directory containing a file being edited -- save *appears* to work, but doesn't.
(1:00x)  [ ] when a local_hub is starting, show a progress meter... (and sequence of messages)

= Major Show-stopper Bugs =
(1:00?) [ ] I think GAP doesn't work at all in the new worksheets.

= Accounts =

Each account will have a list of unix users associated to it, starting with one.
These will be listed in the settings page.
A unix user = username@host... such that hub can ssh in.
Unix users can be shared with other users of SMC; if a user is shared, then both users of SMC have 100% access to everything.
Database table that lists all projects for a given user.

(1:00?)  [ ] When creating a new project, option to choose from a list of users if there is more than one user associated to an account.
(1:30?)  [ ] admin.py -- write Python code to login, then sudo and configure accounts on a machine for users,
               then record that this succeeded in the database.
          admin.provision('03salvus-users', k, max_disk=4096)
          # Makes it so the accounts of the form smc1, smc2, smc3,...,smck, exist, on that machine,
          # with /home/smc[n] built from a template, and ssh-keys access setup
          # Also they have the given disk quota.
          Here the machine name is as listed in the the hosts file.
(1:00?) [ ] hub -- when a user creates an account, assign them a unix user.
(1:30?) [ ] For easy user-only recover of mistakes, setup rsnapshot
            on the same virtual machine, made with rsync,
            and way to browse it (symlink to path of project)
(1:30?) [ ] When a user logs in and accesses a project (if we haven't already in the last x
	       hours) do a compressed tarball backup of the project.
            Next time, only include files that were modified since the
            last backup by using the options mentioned here:
                http://catlingmindswipe.blogspot.com/2010/02/linux-how-to-incremental-backups-using.html
(1:30?) [ ] Make a new project from a specific backup of project.
             (just show list of times when there were backups made, and sizes)
(0:45?) [ ] Clone a project (under settings).

= Browse =

(0:30?) [ ] Add a new tab at the top called "Explore" that is to the left of "Your Projects"
(1:00?) [ ] Very basic search page:    (similar function to https://github.com/explore)
               * search = on project name and description (I will have to build indexes at some point...)
               * place to show results
(0:45?) [ ] clicking on a project in result list opens it (as usual) in read/write mode, if you have write access to it.
(0:45?) [ ] write a "visitor" access project mode
(1:00?) [ ] In project browser, any location should have a url which can be used as a shortcut to get back there.
              https://cloud.sagemath.org/projects/project_id/path/in/filesystem
            Make a link to get this next to the file, and also in browser.  Kind of like with google maps.
(0:45?) [ ] Add code to hub so that if user requests such a url, they get that project opened in the given location.
(1:30?) [ ] Implement a simple "single cell" mode for visitor mode (basically, a sage session, but not using this project)
(1:30x) [ ] Implement a simple homework assignment mode for visitor mode, which lets user do problems, with results getting saved somewhere not-public.

= Doc Synchronization =
(1:00?) [ ] eliminate tracking and reporting of which docs/sessions/sage's are open -- just timeout stuff after a while, with some user control of this at some point.
(1:30?) [ ] A project-level chat, in addition to file level -- this gets stored in project_root/.sage-chat
(1:00?) [ ] bug -- when visiting a synchronized editing session after a long time (and sync broken), the first few
        characters typed get jumbled.
(1:00?) [ ] issue: if you open a #! script the first line isn't read until connecting to the sync session,
        so we don't have any way to know the file type... hence the codemirror editor doesn't have
        the right mode.
(1:00?) [ ] when a session has timed out, chat just doesn't work.
        typing once into the session and waiting... makes chat work.

(0:45?) [ ] re-enable (and test) automatic timeout of sync sessions in local_hub

(1:30?) [ ] worksheet sync: define code to diff two worksheets and make a patch
(1:30?) [ ] worksheet sync: define code to apply a patch to a worksheet
(1:30?) [ ] worksheet sync: integrate code for using these other diff/patch functions into client
(1:30?) [ ] worksheet sync: integrate code for using these other diff/patch functions into hub
(1:30?) [ ] worksheet sync: integrate code for using these other diff/patch functions into local hub


= Deploy =

(0:30?)  [x] (0:14) apply security updates and reboot 01salvus (done) and 06salvus (done)
(1:00?)  [ ] MINIFY actual page js
(1:00?)  [ ] change any hard coded "salv.us" to cloud.sagemath.org
(0:30?)  [ ] make sure email reset works with cloud.sagemath.org
(1:00?)  [ ] build virtual machine that is up2date and has all necessary packages (including ghostview, etc.)
(0:30?)  [ ] define topology file for deployment
(0:30?)  [ ] get it running
(1:00?)  [ ] get ssl cert setup for cloud.sagemath.org


= Graphics =

(4:00x)    [ ] attempt very basic 3d rendering using three.js
(1:00?)  [ ] bug -- changing interact control externally does change control, but doesn't re-evaluate function.
@interact
def f(c=Color('blue'), thickness=(1..30)):
    show(plot(sin, color=c, thickness=thickness))
f.thickness=20
